/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x3819=['change:_isConnected','_revisionTracker','_waitForServiceReady','setSource','off','authorsIds','400','affectsData','has','map','repository','config','buildRevisionData','cloud-services-internal-error:\x20Revision\x20History\x20Service\x20is\x20not\x20connected.','all','baseVersion','getRevisions','editor','addRevisionData','_getLatestVersionFromServerOperations','message','authors','startsWith','_getLatestVersion','updateRevisions','init','_offset','Users','stopListening','change:_isPendingUpdate','creatorId','code','destroy','plugins','getOperations','cloud-services-internal-error:\x20Request\x20timeout.','connection','getRevision','cloudServices.bundleVersion','_oldOffset','listenTo','state','_update','_handleRevisionsUpdate','connected','diffData','RevisionHistoryService','keys','addUser','reconnect','set','then','_createCurrentRevision','isEnabled','catch','_lastRequestId','currentRevision','toVersion','reInit','type','get','isBundleUploaded','isEmptyCurrent','_bufferUpdate','filter','_isPendingUpdate','reverse','remove','_preventResendingRevisionData','addToReconnectionStack','serverHistory','max','RevisionTracker','fromVersion','bind','length','_fetchMissingUsers','revisionHistory.resumeUnsavedRevision','sessionId','add','_revisionHistoryService','_domEmitter','getUser','_fixRevision','createdAt'];(function(_0x480515,_0x3819dc){const _0x5789a0=function(_0x2a3f4b){while(--_0x2a3f4b){_0x480515['push'](_0x480515['shift']());}};_0x5789a0(++_0x3819dc);}(_0x3819,0x192));const _0x5789=function(_0x480515,_0x3819dc){_0x480515=_0x480515-0x0;let _0x5789a0=_0x3819[_0x480515];return _0x5789a0;};import{Plugin as _0x4147e5}from'ckeditor5/src/core';import{version as _0xd20d2d}from'ckeditor5/src/utils';import{Users as _0x937e00}from'ckeditor5-collaboration/src/collaboration-core';import _0x5c95ab from'../realtimecollaborativeediting/realtimecollaborationclient';import _0x3dc164 from'../realtimecollaborativeediting/websocketgateway';import _0xead7f2 from'../realtimecollaborativeediting/sessions';import _0x9f8a54 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x331eab from'@ckeditor/ckeditor-cloud-services-collaboration/src/revision-history/revisionhistoryservice';import _0x234678 from'@ckeditor/ckeditor-cloud-services-collaboration/src/editor/editorservice';export default class v extends _0x4147e5{static get['requires'](){return[_0x3dc164,_0x5c95ab,_0x5789('0xa'),_0xead7f2,_0x937e00];}async[_0x5789('0x30')](){this['_lastRequestId']=null,this[_0x5789('0x18')]=this['editor'][_0x5789('0x38')]['get'](_0x5789('0xa'));const _0x23ca62=this['editor']['plugins']['get'](_0x5c95ab),_0x3b981f=_0x23ca62['serverHistory'],_0x4744ad=this['editor'][_0x5789('0x38')]['get'](_0x3dc164);_0x4744ad[_0x5789('0x7')](this);const _0x32c4cf=this['editor']['config']['get']('collaboration.channelId');this[_0x5789('0x12')]=new v[(_0x5789('0x45'))](_0x32c4cf),this[_0x5789('0x18')][_0x5789('0x1a')]({'history':_0x3b981f,'getLatestVersion':()=>this[_0x5789('0x2e')](),'getCurrentRevisionId':()=>_0x23ca62[_0x5789('0x10')]});const _0x34e031=this['editor'][_0x5789('0x22')]['get'](_0x5789('0x3d'))||_0xd20d2d,_0x364e6a=await _0x234678[_0x5789('0x54')](_0x4744ad[_0x5789('0x3b')],_0x34e031);_0x364e6a&&this[_0x5789('0x28')][_0x5789('0x22')][_0x5789('0x49')](_0x5789('0xf'),!0x1),this[_0x5789('0x18')]['adapter']={'getRevision':async({revisionId:_0x5f0f55})=>(await this[_0x5789('0x19')](),await this['_revisionHistoryService'][_0x5789('0x3c')](_0x5f0f55)),'updateRevisions':async _0x483ac8=>{await this[_0x5789('0x19')]();const _0x5151e3=this[_0x5789('0x18')][_0x5789('0x4f')];if(_0x364e6a){if(0x0===(_0x483ac8=_0x483ac8[_0x5789('0x2')](_0x216dd5=>_0x216dd5['id']!==_0x5151e3['id']))['length'])return;}else for(const _0x43c8b3 of _0x483ac8)_0x43c8b3['id']===_0x5151e3['id']&&(_0x43c8b3[_0x5789('0x0')]=_0x43c8b3['fromVersion']===_0x43c8b3[_0x5789('0x50')]);return this[_0x5789('0x12')][_0x5789('0x2f')](_0x483ac8,this[_0x5789('0x4e')])[_0x5789('0x4a')](_0x2bc0ac=>{this[_0x5789('0x4e')]=_0x2bc0ac;})[_0x5789('0x4d')](_0x5dd5fd=>{if(!(E(_0x5dd5fd)||_0x5789('0x1d')===_0x5dd5fd[_0x5789('0x36')]&&void 0x0!==_0x5dd5fd['data']['wrongRequestId']))throw _0x5dd5fd;for(const _0x203a56 of _0x483ac8){!this['_revisionTracker'][_0x5789('0x21')][_0x5789('0x3c')](_0x203a56['id'])||this['_revisionTracker'][_0x5789('0x1')](_0x203a56['id'],_0x203a56,!0x1);}if(E(_0x5dd5fd))throw _0x5dd5fd;});}},this[_0x5789('0x3f')](this['_revisionHistoryService'],'revisionsUpdated',(_0x54189b,{revisionsData:_0x33160e,requestId:_0x2fa647})=>{Math[_0x5789('0x9')](..._0x33160e['map'](_0x2dd6af=>_0x2dd6af[_0x5789('0x50')]))>this[_0x5789('0x2a')]()-0x1?this[_0x5789('0x2e')]()[_0x5789('0x4a')](()=>{this[_0x5789('0x42')](_0x33160e,_0x2fa647);}):this[_0x5789('0x42')](_0x33160e,_0x2fa647);});const {revisions:_0x3491dc,requestId:_0x3d6777}=await this[_0x5789('0x12')]['connect'](_0x4744ad[_0x5789('0x3b')]);this[_0x5789('0x4e')]=_0x3d6777,await this[_0x5789('0xe')](_0x3491dc);for(const _0x1c85d2 of _0x3491dc)this['_revisionTracker'][_0x5789('0x29')](_0x1c85d2);this[_0x5789('0x3f')](_0x23ca62,_0x5789('0x17'),(_0x27b595,_0x1170d5,_0x50c970)=>{_0x50c970&&(this['_oldOffset']=_0x23ca62[_0x5789('0x31')],_0x27b595[_0x5789('0x1b')]());}),this[_0x5789('0x18')][_0x5789('0xc')](_0x5789('0x4c'))['to'](_0x4744ad,_0x5789('0x40'),_0x3015da=>_0x5789('0x43')===_0x3015da);}async[_0x5789('0x48')](){const _0x54e453=this[_0x5789('0x28')][_0x5789('0x38')][_0x5789('0x53')](_0x3dc164),_0x392318=this[_0x5789('0x28')][_0x5789('0x38')][_0x5789('0x53')](_0x5c95ab),_0x2ac922=async()=>{const _0x1bc4f1=this[_0x5789('0x18')][_0x5789('0x4f')],_0x16fc0f=_0x1bc4f1['id'],_0x4d3ce9=_0x16fc0f!==_0x392318['sessionId'];if(_0x4d3ce9){const _0x57ea2c=_0x392318[_0x5789('0x31')]-this[_0x5789('0x3e')],_0xbc4fcd=this[_0x5789('0x2a')]();this[_0x5789('0x18')]['_revisionDataBuilder'][_0x5789('0x51')]();if(_0x1bc4f1[_0x5789('0x50')]+_0x57ea2c!==_0xbc4fcd){const _0x175d9c=_0x1bc4f1[_0x5789('0xb')]+_0x57ea2c,_0x3619da=this['editor'][_0x5789('0x38')][_0x5789('0x53')]('Users'),_0x17809b=this[_0x5789('0x18')]['buildRevisionData']({'currentRevision':_0x1bc4f1,'from':_0x175d9c,'to':_0xbc4fcd});_0x17809b['id']=_0x1bc4f1['id'];const _0x517a04=_0x17809b[_0x5789('0x1c')][_0x5789('0x20')](_0x39aaa4=>_0x3619da[_0x5789('0x14')](_0x39aaa4));_0x1bc4f1['_update']({..._0x17809b,'authors':_0x517a04},!0x0),this['_revisionTracker'][_0x5789('0x1')](_0x1bc4f1['id'],_0x17809b,!0x0);}this['_revisionTracker']['_startingVersion']=_0xbc4fcd,(_0x1bc4f1['toVersion']===_0x1bc4f1[_0x5789('0xb')]&&!this[_0x5789('0x18')]['_bufferedUpdates'][_0x5789('0x1f')](_0x16fc0f)&&this['_revisionTracker'][_0x5789('0x21')]['_revisions'][_0x5789('0x5')](_0x16fc0f),this[_0x5789('0x18')][_0x5789('0x4b')](_0xbc4fcd));}const {revisions:_0x26aff0,requestId:_0x14fb8d}=await this[_0x5789('0x12')][_0x5789('0x48')](_0x54e453[_0x5789('0x3b')],this['_lastRequestId']);_0x4d3ce9&&_0x26aff0[_0x5789('0xd')]>0x0?_0x392318['_handleReconnectionError']():(await this[_0x5789('0xe')](_0x26aff0),this['_handleRevisionsUpdate'](_0x26aff0,_0x14fb8d),this['_revisionTracker']['sendBufferedUpdates']());};return _0x392318['_isConnected']?_0x2ac922():new Promise((_0x453067,_0xccad21)=>{_0x392318['once']('change:_isConnected',()=>{_0x2ac922()['then'](_0x453067)[_0x5789('0x4d')](_0xccad21);});});}[_0x5789('0x37')](){this[_0x5789('0x13')]&&this[_0x5789('0x13')][_0x5789('0x33')](),super['destroy']();}async['_waitForServiceReady'](){this[_0x5789('0x12')]['isConnected']||await new Promise(_0x12e723=>{this[_0x5789('0x3f')](this['_revisionHistoryService'],'connected',_0x3639ea=>{_0x3639ea[_0x5789('0x1b')](),_0x12e723();});});}[_0x5789('0x2a')](){const _0x47de56=this[_0x5789('0x28')][_0x5789('0x38')]['get'](_0x5c95ab)[_0x5789('0x8')];for(const _0x56e0d4 of _0x47de56[_0x5789('0x39')]()['reverse']())if('marker'!==_0x56e0d4[_0x5789('0x52')]||_0x56e0d4[_0x5789('0x1e')])return _0x56e0d4[_0x5789('0x26')]+0x1;}[_0x5789('0x2e')](){const _0x334cb7=this[_0x5789('0x28')][_0x5789('0x38')][_0x5789('0x53')](_0x5c95ab);return new Promise(_0x1ad21e=>{_0x334cb7[_0x5789('0x3')]?_0x334cb7['once'](_0x5789('0x34'),()=>{_0x1ad21e(this[_0x5789('0x2a')]());}):_0x1ad21e(this[_0x5789('0x2a')]());});}[_0x5789('0x42')](_0x385072,_0x52b368){const _0x54cbfa=this[_0x5789('0x18')][_0x5789('0x21')];this[_0x5789('0x4e')]=_0x52b368;for(const _0x5147c2 of _0x385072){const _0x384641=_0x54cbfa[_0x5789('0x3c')](_0x5147c2['id']);if(_0x384641){if((_0x5147c2[_0x5789('0xb')]||_0x5147c2[_0x5789('0x50')])&&(_0x5147c2[_0x5789('0x44')]=null),_0x384641===this['_revisionTracker'][_0x5789('0x4f')]){const _0x5f37f4=Math['max'](_0x384641['toVersion'],_0x5147c2[_0x5789('0x50')]),_0x5f47ce=Math[_0x5789('0x9')](_0x384641['fromVersion'],_0x5147c2['fromVersion']);let _0x16b52b;_0x384641[_0x5789('0x50')]===_0x5147c2[_0x5789('0x50')]&&_0x384641['fromVersion']===_0x5147c2['fromVersion']?(_0x16b52b=!0x0,this['_preventResendingRevisionData'](_0x5147c2)):_0x5147c2['toVersion']===_0x5f37f4&&_0x5147c2[_0x5789('0xb')]===_0x5f47ce?_0x16b52b=!0x1:(_0x384641[_0x5789('0x50')]===_0x5f37f4&&_0x384641['fromVersion']===_0x5f47ce||this[_0x5789('0x15')]({'revision':_0x384641,'from':_0x5f47ce,'to':_0x5f37f4}),_0x16b52b=!0x0),_0x16b52b&&(delete _0x5147c2[_0x5789('0xb')],delete _0x5147c2[_0x5789('0x50')],delete _0x5147c2[_0x5789('0x44')],delete _0x5147c2[_0x5789('0x16')],delete _0x5147c2['authorsIds']);}this[_0x5789('0x18')]['setRevisionData'](_0x5147c2),this[_0x5789('0x6')](_0x5147c2);}else this[_0x5789('0x18')][_0x5789('0x29')](_0x5147c2);}const _0x4bc8a9=_0x54cbfa[_0x5789('0x27')]();_0x4bc8a9[_0x5789('0x4')]();for(let _0xa5f25e=0x0;_0xa5f25e<_0x4bc8a9['length']-0x1;_0xa5f25e++){const _0x1c74fc=_0x4bc8a9[_0xa5f25e],_0x5d05c4=_0x4bc8a9[_0xa5f25e+0x1];if(_0x1c74fc[_0x5789('0xb')]<_0x5d05c4['toVersion']){const _0x4b4a4e=_0x5d05c4[_0x5789('0x50')],_0x25025b=Math[_0x5789('0x9')](_0x4b4a4e,_0x1c74fc[_0x5789('0x50')]);this[_0x5789('0x15')]({'revision':_0x1c74fc,'from':_0x4b4a4e,'to':_0x25025b});}}}[_0x5789('0x15')]({revision:_0x18534b,from:_0x2fd32d,to:_0x30a5ab}={}){const _0x31e7c4=this[_0x5789('0x28')][_0x5789('0x38')][_0x5789('0x53')](_0x5789('0x32')),_0x3b3f2e=this[_0x5789('0x18')][_0x5789('0x23')]({'revision':_0x18534b,'from':_0x2fd32d,'to':_0x30a5ab});_0x3b3f2e[_0x5789('0x2c')]=_0x3b3f2e['authorsIds'][_0x5789('0x20')](_0x1db22d=>_0x31e7c4[_0x5789('0x14')](_0x1db22d)),_0x18534b[_0x5789('0x41')](_0x3b3f2e);}[_0x5789('0x6')](_0xb358cb){const _0x26f324={};_0x26f324['id']=_0xb358cb['id'];for(const _0x436964 of Object[_0x5789('0x46')](_0xb358cb))'id'!==_0x436964&&(_0x26f324[_0x436964]=void 0x0);this['_revisionTracker'][_0x5789('0x1')](_0x26f324['id'],_0x26f324,!0x0);}[_0x5789('0xe')](_0x3dfae1){const _0x2ea03a=this['editor'][_0x5789('0x38')]['get'](_0x937e00),{connection:_0x2fea6c}=this[_0x5789('0x28')][_0x5789('0x38')][_0x5789('0x53')](_0x3dc164),_0x3697b7=new Set();for(const _0x1ed8cb of _0x3dfae1){for(const _0xe4a7aa of _0x1ed8cb[_0x5789('0x1c')])_0x4af5ec(_0xe4a7aa);_0x1ed8cb[_0x5789('0x35')]&&_0x4af5ec(_0x1ed8cb['creatorId']);}return Promise[_0x5789('0x25')](Array['from'](_0x3697b7,async _0x18b577=>{const _0x5e0183=await _0x9f8a54[_0x5789('0x53')](_0x2fea6c,_0x18b577);_0x2ea03a['getUser'](_0x18b577)||_0x2ea03a[_0x5789('0x47')](_0x5e0183);}));function _0x4af5ec(_0x102cea){_0x2ea03a[_0x5789('0x14')](_0x102cea)||_0x3697b7[_0x5789('0x11')](_0x102cea);}}}function E(_0x34bb13){return _0x34bb13[_0x5789('0x2b')][_0x5789('0x2d')](_0x5789('0x24'))||_0x34bb13['message'][_0x5789('0x2d')]('cloud-services-internal-error:\x20Not\x20connected.')||_0x34bb13['message']['startsWith'](_0x5789('0x3a'));}v['RevisionHistoryService']=_0x331eab;