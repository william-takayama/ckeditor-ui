/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x521c=['values','connected','Sessions','_uniqueUsersCount','getUserSessions','state','delete','sessions-register-already-registered','_handleSessionAdd','_createUser','get','allConnectedUsers','getUserRole','user','set','change:state','has','fire','size','unregister','init','clear','pluginName','orderNumber','forEach','defineMe','requires','add','_registeredSessions','remove','addUser','mySessionId','_handleSessionRemove','listenTo','connection','sessions-unregister-not-exist','stopListening','channelSessions','context','channelConnectedUsers','plugins','_users'];(function(_0x184968,_0x521c87){const _0x1a53dd=function(_0x2c179d){while(--_0x2c179d){_0x184968['push'](_0x184968['shift']());}};_0x1a53dd(++_0x521c87);}(_0x521c,0xca));const _0x1a53=function(_0x184968,_0x521c87){_0x184968=_0x184968-0x0;let _0x1a53dd=_0x521c[_0x184968];return _0x1a53dd;};import{ContextPlugin as _0x814ed1}from'ckeditor5/src/core';import{Collection as _0x50281a,CKEditorError as _0x387855}from'ckeditor5/src/utils';import _0x81a1ff from'./websocketgateway';import{Users as _0x4ea21f}from'ckeditor5-collaboration/src/collaboration-core';export default class r extends _0x814ed1{static get[_0x1a53('0x1e')](){return _0x1a53('0xa');}static get[_0x1a53('0x22')](){return[_0x81a1ff,_0x4ea21f];}[_0x1a53('0x1c')](){const _0x42bcb0=this['context'],_0x2842ab=_0x42bcb0[_0x1a53('0x6')][_0x1a53('0x12')](_0x81a1ff);this[_0x1a53('0x3')]=new Map(),this[_0x1a53('0x5')]=new Map(),this['allConnectedUsers']=new _0x50281a(),this[_0x1a53('0x24')]=new Map(),this[_0x1a53('0xb')]=0x0,this[_0x1a53('0x7')]=_0x42bcb0['plugins'][_0x1a53('0x12')](_0x4ea21f),this[_0x1a53('0x29')](_0x2842ab,_0x1a53('0x17'),(_0x1a0bbf,_0x1c6471,_0x489302)=>{if(_0x1a53('0x9')!==_0x489302)this['channelSessions'][_0x1a53('0x20')](_0x4bca7c=>_0x4bca7c[_0x1a53('0x1d')]()),this[_0x1a53('0x5')][_0x1a53('0x20')](_0x5554f3=>_0x5554f3[_0x1a53('0x1d')]()),this[_0x1a53('0x13')][_0x1a53('0x1d')]();else for(const [_0x138c89,_0x33cdcf]of this['_registeredSessions'])for(const _0x3e4295 of _0x33cdcf)this[_0x1a53('0x10')](_0x138c89,_0x3e4295);}),this[_0x1a53('0x11')](_0x2842ab[_0x1a53('0x0')]['me'],!0x0);}['register'](_0x3cd1ca,_0x323556){if(this[_0x1a53('0x24')]['has'](_0x3cd1ca))throw new _0x387855(_0x1a53('0xf'),null,{'channelId':_0x3cd1ca});this[_0x1a53('0x24')]['set'](_0x3cd1ca,_0x323556),this[_0x1a53('0x3')]['set'](_0x3cd1ca,new _0x50281a()),this[_0x1a53('0x5')][_0x1a53('0x16')](_0x3cd1ca,new _0x50281a()),this[_0x1a53('0x29')](_0x323556,_0x1a53('0x23'),(_0x367385,_0x579e3f)=>this['_handleSessionAdd'](_0x3cd1ca,_0x579e3f)),this[_0x1a53('0x29')](_0x323556,'remove',(_0x3ccf49,_0x3d0aaf)=>this['_handleSessionRemove'](_0x3cd1ca,_0x3d0aaf));for(const _0x238af5 of _0x323556)this[_0x1a53('0x10')](_0x3cd1ca,_0x238af5);}[_0x1a53('0x1b')](_0x5e5862){if(!this[_0x1a53('0x24')][_0x1a53('0x18')](_0x5e5862))throw new _0x387855(_0x1a53('0x1'),null,{'channelId':_0x5e5862});const _0x319934=this['_registeredSessions'][_0x1a53('0x12')](_0x5e5862);this[_0x1a53('0x2')](_0x319934);for(const _0x36226e of _0x319934)'connected'===this[_0x1a53('0x4')][_0x1a53('0x6')]['get'](_0x81a1ff)[_0x1a53('0xd')]&&this[_0x1a53('0x28')](_0x5e5862,_0x36226e);this[_0x1a53('0x24')][_0x1a53('0xe')](_0x5e5862),this[_0x1a53('0x3')][_0x1a53('0xe')](_0x5e5862),this[_0x1a53('0x5')]['delete'](_0x5e5862);}get[_0x1a53('0x27')](){return this[_0x1a53('0x4')][_0x1a53('0x6')][_0x1a53('0x12')](_0x81a1ff)[_0x1a53('0x0')]['sessionId'];}['getUserBySessionId'](_0x4f0f88){for(const _0x15b9ed of this[_0x1a53('0x3')][_0x1a53('0x8')]())for(const _0x3c3f13 of _0x15b9ed)if(_0x3c3f13['id']===_0x4f0f88)return _0x3c3f13[_0x1a53('0x15')];}[_0x1a53('0xc')](_0x31cf6b,_0xaaaacc){const _0x3022bd=_0xaaaacc?[this[_0x1a53('0x3')]['get'](_0xaaaacc)]:this[_0x1a53('0x3')][_0x1a53('0x8')](),_0x183b12=new Set();for(const _0x2a2978 of _0x3022bd)for(const _0x395bae of _0x2a2978)_0x395bae[_0x1a53('0x15')]['id']===_0x31cf6b['id']&&_0x183b12[_0x1a53('0x23')](_0x395bae['id']);return _0x183b12;}[_0x1a53('0x14')](_0x4df93b){for(const _0x4a82e4 of this[_0x1a53('0x3')][_0x1a53('0x8')]())for(const _0x3aad60 of _0x4a82e4)if(_0x3aad60[_0x1a53('0x15')]===_0x4df93b)return _0x3aad60['role'];}[_0x1a53('0x10')](_0x748b3,_0x14f03b){if(_0x1a53('0x9')!==this[_0x1a53('0x4')][_0x1a53('0x6')][_0x1a53('0x12')](_0x81a1ff)[_0x1a53('0xd')])return;const _0x6b4dc6=_0x14f03b['user'],_0x176d9d=this[_0x1a53('0x7')]['getUser'](_0x6b4dc6['id'])||this[_0x1a53('0x11')](_0x6b4dc6),_0x482163=Object['assign']({},_0x14f03b,{'user':_0x176d9d});this['channelSessions'][_0x1a53('0x12')](_0x748b3)['add'](_0x482163);const _0x545937=this[_0x1a53('0x5')][_0x1a53('0x12')](_0x748b3);_0x545937[_0x1a53('0x18')](_0x176d9d['id'])||_0x545937[_0x1a53('0x23')](_0x176d9d),this[_0x1a53('0x13')][_0x1a53('0x18')](_0x176d9d['id'])||this[_0x1a53('0x13')][_0x1a53('0x23')](_0x176d9d),this[_0x1a53('0x19')]('sessionAdd:'+_0x748b3,{'channelId':_0x748b3,'session':_0x482163});}[_0x1a53('0x28')](_0x119e4d,_0x1ccee7){if(_0x1a53('0x9')!==this['context'][_0x1a53('0x6')][_0x1a53('0x12')](_0x81a1ff)[_0x1a53('0xd')])return;const _0x3842aa=this[_0x1a53('0x5')][_0x1a53('0x12')](_0x119e4d),_0x2cc1d5=_0x1ccee7['user'];this[_0x1a53('0x3')][_0x1a53('0x12')](_0x119e4d)['remove'](_0x1ccee7['id']),_0x3842aa['has'](_0x2cc1d5['id'])&&!this[_0x1a53('0xc')](_0x2cc1d5,_0x119e4d)[_0x1a53('0x1a')]&&_0x3842aa[_0x1a53('0x25')](_0x2cc1d5['id']),this['allConnectedUsers'][_0x1a53('0x12')](_0x2cc1d5['id'])&&!this[_0x1a53('0xc')](_0x2cc1d5)[_0x1a53('0x1a')]&&this[_0x1a53('0x13')][_0x1a53('0x25')](_0x2cc1d5['id']);}[_0x1a53('0x11')](_0x3c9c82,_0x20f221){const _0x2d6f23=this[_0x1a53('0x7')][_0x1a53('0x26')](_0x3c9c82);return _0x20f221&&this[_0x1a53('0x7')][_0x1a53('0x21')](_0x3c9c82['id']),_0x2d6f23[_0x1a53('0x1f')]=this['_uniqueUsersCount']++,_0x2d6f23;}}