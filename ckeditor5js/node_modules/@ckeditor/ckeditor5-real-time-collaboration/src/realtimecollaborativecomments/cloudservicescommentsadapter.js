/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x30d3=['delete','getComment','CommentsRepository','_connectService','_fetchMissingUsersForThreads','_terminateService','userId','message','Permissions','attributes','init','permissions','get','_setUpService','update','set','getConnectedSessions','config','listenTo','_services','addComment','hasCommentThread','has','startsWith','context','code','getCommentThread','_getService','CommentsService','removeCommentThread','commentUpdated','register','reconnect','collaboration.channelId','mySessionId','destroy','from','cloud-services-internal-error:\x20Not\x20connected.','plugins','createdAt','addUser','commentAdded','catch','connect','removeComment','commentId','commentThreadId','setPermissions','remove','keys','unregister','getCommentThreads','content','404','cloudservicescommentsadapter-connect-already-connected','off','comments','getUser','sessionAdd:','commentThreadRemoved','addCommentThread','add'];(function(_0x384d78,_0x30d3b1){const _0x56d068=function(_0x4ec566){while(--_0x4ec566){_0x384d78['push'](_0x384d78['shift']());}};_0x56d068(++_0x30d3b1);}(_0x30d3,0x150));const _0x56d0=function(_0x384d78,_0x30d3b1){_0x384d78=_0x384d78-0x0;let _0x56d068=_0x30d3[_0x384d78];return _0x56d068;};import{Context as _0x3418c0,ContextPlugin as _0x137fbf}from'ckeditor5/src/core';import{CKEditorError as _0x5d5882}from'ckeditor5/src/utils';import{Users as _0x3803cc}from'ckeditor5-collaboration/src/collaboration-core';import _0x3305ae from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import _0x179bbf from'@ckeditor/ckeditor-cloud-services-collaboration/src/comments-v2/commentsservice';import _0x5860da from'../realtimecollaborativeediting/websocketgateway';import _0x1cb77a from'../realtimecollaborativeediting/sessions';export default class a extends _0x137fbf{static get['requires'](){return[_0x5860da,'CommentsRepository',_0x1cb77a,_0x3803cc];}constructor(_0x26eeca){super(_0x26eeca),this['_services']=new Map();}async[_0x56d0('0x2e')](){const _0x3821e7=this[_0x56d0('0x3c')],_0x38b5d1=_0x3821e7[_0x56d0('0xc')][_0x56d0('0x30')]('CommentsRepository');if(_0x3821e7[_0x56d0('0xc')][_0x56d0('0x30')](_0x5860da)['addToReconnectionStack'](this),_0x38b5d1['adapter']={'getCommentThread':async({channelId:_0x1c5d2c,threadId:_0x39085e})=>{const _0x2567a7=await this['_getService'](_0x1c5d2c)[_0x56d0('0x0')](_0x39085e)['catch'](R);return await this[_0x56d0('0x28')]([_0x2567a7]),{'threadId':_0x2567a7[_0x56d0('0x14')],'comments':_0x2567a7['comments']['map'](T)};},'removeCommentThread':({channelId:_0xf97fb4,threadId:_0x9029a6})=>this[_0x56d0('0x1')](_0xf97fb4)[_0x56d0('0x3')](_0x9029a6)[_0x56d0('0x10')](S)[_0x56d0('0x10')](R),'addComment':({channelId:_0x4befba,threadId:_0x152ab0,commentId:_0x29ea4b,content:_0x358619,attributes:_0x237145})=>this[_0x56d0('0x1')](_0x4befba)[_0x56d0('0x38')](_0x152ab0,_0x29ea4b,_0x358619,_0x237145)[_0x56d0('0x10')](R),'updateComment':({channelId:_0x7f124f,threadId:_0x515ddb,commentId:_0x4905fd,content:_0x162eb7,attributes:_0x21f30a})=>this['_getService'](_0x7f124f)['updateComment'](_0x515ddb,_0x4905fd,_0x162eb7,_0x21f30a)[_0x56d0('0x10')](S)[_0x56d0('0x10')](R),'removeComment':({channelId:_0xdc0408,threadId:_0x398f8b,commentId:_0x5e9fec})=>this[_0x56d0('0x1')](_0xdc0408)[_0x56d0('0x12')](_0x398f8b,_0x5e9fec)[_0x56d0('0x10')](S)[_0x56d0('0x10')](R)},_0x3821e7 instanceof _0x3418c0){const _0x2e7c6b=_0x3821e7['config'][_0x56d0('0x30')]('collaboration.channelId'),_0x110015=_0x3821e7[_0x56d0('0xc')][_0x56d0('0x30')](_0x1cb77a);await this[_0x56d0('0x31')](_0x2e7c6b);const _0x345a3b=await this[_0x56d0('0x37')]['get'](_0x2e7c6b)[_0x56d0('0x34')]();this['listenTo'](_0x110015,_0x56d0('0x20')+_0x2e7c6b,(_0x211cef,{session:_0x1c1ab0})=>{_0x1c1ab0['id']===_0x110015[_0x56d0('0x8')]&&(_0x211cef[_0x56d0('0x1d')](),this[_0x56d0('0x3c')][_0x56d0('0xc')][_0x56d0('0x30')](_0x56d0('0x2c'))[_0x56d0('0x15')](_0x1c1ab0[_0x56d0('0x2f')],_0x2e7c6b));}),_0x110015[_0x56d0('0x5')](_0x2e7c6b,_0x345a3b);}}async['_setUpService'](_0x5dd232){if(this[_0x56d0('0x37')][_0x56d0('0x3a')](_0x5dd232))throw new _0x5d5882(_0x56d0('0x1c'),null,{'channelId':_0x5dd232});const _0x4040cb=this[_0x56d0('0x3c')][_0x56d0('0xc')][_0x56d0('0x30')]('CommentsRepository'),_0x4355b3=new a[(_0x56d0('0x2'))](_0x5dd232);this[_0x56d0('0x37')][_0x56d0('0x33')](_0x5dd232,_0x4355b3),this[_0x56d0('0x36')](_0x4355b3,_0x56d0('0x21'),(_0x5a1b3,{commentThreadId:_0x559d8c})=>{const _0x367bc1=_0x4040cb[_0x56d0('0x0')](_0x559d8c);_0x367bc1&&_0x367bc1[_0x56d0('0x16')]({'isFromAdapter':!0x0});}),this[_0x56d0('0x36')](_0x4355b3,_0x56d0('0xf'),(_0x44bca9,_0x4b7dfb)=>{const _0x5ae802=_0x4b7dfb[_0x56d0('0x14')];_0x4040cb[_0x56d0('0x39')](_0x5ae802)||_0x4040cb[_0x56d0('0x22')]({'channelId':_0x5dd232,'threadId':_0x5ae802,'isFromAdapter':!0x0});const _0x195a92=_0x4040cb['getCommentThread'](_0x5ae802);_0x195a92&&_0x195a92[_0x56d0('0x38')](Object['assign'](T(_0x4b7dfb),{'isFromAdapter':!0x0}));}),this[_0x56d0('0x36')](_0x4355b3,_0x56d0('0x4'),(_0x293a3b,{commentThreadId:_0x31df40,commentId:_0x231b08,content:_0x1aff4c,attributes:_0xa12455})=>{const _0x4313c1=_0x4040cb[_0x56d0('0x0')](_0x31df40);if(_0x4313c1){const _0x1a15fe=_0x4313c1[_0x56d0('0x25')](_0x231b08);_0x1a15fe&&_0x1a15fe[_0x56d0('0x32')]({'content':_0x1aff4c,'attributes':_0xa12455,'isFromAdapter':!0x0});}}),this[_0x56d0('0x36')](_0x4355b3,'commentRemoved',(_0x25f0e5,{commentThreadId:_0x4c435b,commentId:_0x5a34cb})=>{const _0xcd4601=_0x4040cb[_0x56d0('0x0')](_0x4c435b);if(_0xcd4601){const _0x2ab5c6=_0xcd4601[_0x56d0('0x25')](_0x5a34cb);_0x2ab5c6&&_0x2ab5c6[_0x56d0('0x16')]({'isFromAdapter':!0x0});}}),await this[_0x56d0('0x27')](_0x5dd232);}[_0x56d0('0x9')](){if(this[_0x56d0('0x3c')]instanceof _0x3418c0){const _0x5ff6a=this[_0x56d0('0x3c')][_0x56d0('0x35')][_0x56d0('0x30')](_0x56d0('0x7'));this['_terminateService'](_0x5ff6a);}}[_0x56d0('0x29')](_0x15dff5){if(!this[_0x56d0('0x37')][_0x56d0('0x3a')](_0x15dff5))throw new _0x5d5882('cloudservicescommentsadapter-disconnect-not-exist',null,{'channelId':_0x15dff5});this[_0x56d0('0x1')](_0x15dff5)['disconnect'](),this[_0x56d0('0x37')]['delete'](_0x15dff5);}async[_0x56d0('0x6')](){for(const _0x1aeb51 of this['_services'][_0x56d0('0x17')]())await this[_0x56d0('0x27')](_0x1aeb51);if(this[_0x56d0('0x3c')]instanceof _0x3418c0){const _0x4444f3=this['context'][_0x56d0('0x35')][_0x56d0('0x30')](_0x56d0('0x7')),_0x458f53=this[_0x56d0('0x3c')]['plugins'][_0x56d0('0x30')](_0x1cb77a);_0x458f53[_0x56d0('0x18')](_0x4444f3);const _0x1ff3f9=await this[_0x56d0('0x37')][_0x56d0('0x30')](_0x4444f3)['getConnectedSessions']();_0x458f53[_0x56d0('0x5')](_0x4444f3,_0x1ff3f9);}}async[_0x56d0('0x27')](_0xa800a7){const {connection:_0x47eaed}=this[_0x56d0('0x3c')][_0x56d0('0xc')][_0x56d0('0x30')](_0x5860da),_0x2d37a8=this['context'][_0x56d0('0xc')][_0x56d0('0x30')](_0x56d0('0x26')),_0x25f480=this[_0x56d0('0x37')][_0x56d0('0x30')](_0xa800a7),_0xf212f6=await _0x25f480[_0x56d0('0x11')](_0x47eaed);await this['_fetchMissingUsersForThreads'](_0xf212f6);const _0x4b53bc=new Set(Array[_0x56d0('0xa')](_0x2d37a8[_0x56d0('0x19')]({'channelId':_0xa800a7}),_0x1b7ef3=>_0x1b7ef3['id']));for(const _0x182cf2 of _0xf212f6)_0x4b53bc[_0x56d0('0x24')](_0x182cf2['commentThreadId']);for(const _0x2d2059 of _0x4b53bc)_0x2d37a8[_0x56d0('0x0')](_0x2d2059)[_0x56d0('0x16')]({'isFromAdapter':!0x0});for(const _0xd836c of _0xf212f6){let _0x32f792=_0x2d37a8[_0x56d0('0x0')](_0xd836c[_0x56d0('0x14')]);_0x32f792||(_0x32f792=_0x2d37a8[_0x56d0('0x22')]({'channelId':_0xa800a7,'threadId':_0xd836c[_0x56d0('0x14')],'isFromAdapter':!0x0}));const _0x4b282e=new Set(Array[_0x56d0('0xa')](_0x32f792['comments'],_0x1fd1dd=>_0x1fd1dd['id']));for(const _0x4246b6 of _0xd836c[_0x56d0('0x1e')])_0x4b282e[_0x56d0('0x24')](_0x4246b6[_0x56d0('0x13')]);for(const _0x7ea093 of _0x4b282e)_0x32f792[_0x56d0('0x25')](_0x7ea093)['remove']({'isFromAdapter':!0x0});for(const _0x3c6942 of _0xd836c[_0x56d0('0x1e')]){const _0x39b666=_0x32f792[_0x56d0('0x25')](_0x3c6942[_0x56d0('0x13')]);_0x39b666?_0x39b666[_0x56d0('0x1a')]!==_0x3c6942[_0x56d0('0x1a')]&&_0x39b666[_0x56d0('0x32')]({'content':_0x3c6942['content'],'isFromAdapter':!0x0}):_0x32f792[_0x56d0('0x38')](Object['assign'](T(_0x3c6942),{'isFromAdapter':!0x0}));}}}[_0x56d0('0x1')](_0x1e27db){if(!this[_0x56d0('0x37')][_0x56d0('0x3a')](_0x1e27db))throw new _0x5d5882('cloudservicescommentsadapter-service-not-exist',null,{'channelId':_0x1e27db});return this[_0x56d0('0x37')][_0x56d0('0x30')](_0x1e27db);}[_0x56d0('0x28')](_0x14ca98){const _0x1913d0=this[_0x56d0('0x3c')][_0x56d0('0xc')][_0x56d0('0x30')](_0x3803cc),{connection:_0x1c13d7}=this[_0x56d0('0x3c')]['plugins'][_0x56d0('0x30')](_0x5860da),_0x3b2f56=new Set();for(const {comments:_0x3589bb}of _0x14ca98)for(const {userId:_0x425721}of _0x3589bb)_0x1913d0[_0x56d0('0x1f')](_0x425721)||_0x3b2f56[_0x56d0('0x23')](_0x425721);return Promise['all'](Array[_0x56d0('0xa')](_0x3b2f56,async _0x3e0370=>{const _0x4df2a1=await _0x3305ae['get'](_0x1c13d7,_0x3e0370);_0x1913d0[_0x56d0('0x1f')](_0x3e0370)||_0x1913d0[_0x56d0('0xe')](_0x4df2a1);}));}}async function S(_0x128014){if(_0x56d0('0x1b')!==_0x128014[_0x56d0('0x3d')])throw _0x128014;}function R(_0x5c3851){if((_0x532aee=_0x5c3851)[_0x56d0('0x2b')][_0x56d0('0x3b')]('cloud-services-internal-error:\x20Comments\x20Service\x20is\x20not\x20connected.')||_0x532aee[_0x56d0('0x2b')]['startsWith'](_0x56d0('0xb'))||_0x532aee[_0x56d0('0x2b')][_0x56d0('0x3b')]('cloud-services-internal-error:\x20Request\x20timeout.'))return new Promise(()=>{});var _0x532aee;throw _0x5c3851;}function T(_0x210f94){return{'threadId':_0x210f94[_0x56d0('0x14')],'commentId':_0x210f94[_0x56d0('0x13')],'content':_0x210f94[_0x56d0('0x1a')],'createdAt':_0x210f94[_0x56d0('0xd')],'authorId':_0x210f94[_0x56d0('0x2a')],'attributes':_0x210f94[_0x56d0('0x2d')]};}a[_0x56d0('0x2')]=_0x179bbf;