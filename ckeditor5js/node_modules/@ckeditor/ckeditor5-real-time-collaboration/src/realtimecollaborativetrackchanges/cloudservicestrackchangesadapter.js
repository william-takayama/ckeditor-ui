/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0xbabf=['delete','adapter','catch','listenTo','TrackChangesService','off','startsWith','suggestionUpdated','TrackChangesEditing','add','_waitForServiceReady','from','_saved','all','attributes','connect','_trackChangesService','values','_bufferedRequests','reconnect','cloud-services-internal-error:\x20Request\x20timeout.','update','init','then','plugins','state','hasSuggestion','find','connection','editor','_fetchMissingUsersForThreads','cloud-services-internal-error:\x20Not\x20connected.','connected','originalSuggestionId','addSuggestionData','open','getUser','get'];(function(_0x3498e7,_0xbabfd2){const _0x23d023=function(_0x21992f){while(--_0x21992f){_0x3498e7['push'](_0x3498e7['shift']());}};_0x23d023(++_0xbabfd2);}(_0xbabf,0x141));const _0x23d0=function(_0x3498e7,_0xbabfd2){_0x3498e7=_0x3498e7-0x0;let _0x23d023=_0xbabf[_0x3498e7];return _0x23d023;};import{Plugin as _0x346bf0}from'ckeditor5/src/core';import _0x528765 from'@ckeditor/ckeditor-cloud-services-collaboration/src/track-changes/trackchangesservice';import _0x510912 from'../realtimecollaborativeediting/websocketgateway';import _0x31af8c from'../realtimecollaborativecomments/cloudservicescommentsadapter';import _0x5f4894 from'@ckeditor/ckeditor-cloud-services-collaboration/src/users/user';import{Users as _0x4cfe9e}from'ckeditor5-collaboration/src/collaboration-core';export default class g extends _0x346bf0{static get['requires'](){return[_0x31af8c,'TrackChangesEditing',_0x510912];}constructor(_0x41dca){super(_0x41dca),this[_0x23d0('0x1')]=new Map();}[_0x23d0('0x5')](){const _0x367bd1=this[_0x23d0('0xc')][_0x23d0('0x7')]['get'](_0x510912),_0x578ed3=this[_0x23d0('0xc')][_0x23d0('0x7')][_0x23d0('0x14')](_0x23d0('0x1d')),_0x5934e0=this[_0x23d0('0xc')]['config'][_0x23d0('0x14')]('collaboration.channelId');return _0x367bd1['addToReconnectionStack'](this),this[_0x23d0('0x25')]=new g[(_0x23d0('0x19'))](_0x5934e0),_0x578ed3[_0x23d0('0x16')]={'getSuggestion':async _0xf25dcc=>{await this[_0x23d0('0x1f')]();const _0x9a0fd7=await this['_trackChangesService'][_0x23d0('0x14')](_0xf25dcc)[_0x23d0('0x17')](R);return await this[_0x23d0('0xd')]([_0x9a0fd7]),_0x9a0fd7;},'addSuggestion':async({id:_0x431f97,type:_0x1e67fb,data:_0x164880,originalSuggestionId:_0x49d998,attributes:_0x9c6b2})=>{await this[_0x23d0('0x1f')]();const _0x347344={'id':_0x431f97,'type':_0x1e67fb,'data':_0x164880,'originalSuggestionId':_0x49d998,'attributes':_0x9c6b2},_0x3880de=await this[_0x23d0('0x25')]['add'](_0x431f97,_0x1e67fb,_0x164880,_0x49d998,_0x9c6b2)[_0x23d0('0x17')](_0x3e4565=>{if(E(_0x3e4565))return new Promise(_0x5b606b=>{this[_0x23d0('0x1')]['set'](_0x431f97,{'resolve':_0x5b606b,'suggestionData':_0x347344});});throw _0x3e4565;});return this[_0x23d0('0x1')][_0x23d0('0x15')](_0x431f97),_0x3880de;},'updateSuggestion':async(_0x388674,_0x3e81ed)=>{if(await this[_0x23d0('0x1f')](),_0x23d0('0x12')!==_0x3e81ed[_0x23d0('0x8')])return this['_trackChangesService'][_0x23d0('0x4')](_0x388674,_0x3e81ed)[_0x23d0('0x17')](R);}},this[_0x23d0('0x18')](this[_0x23d0('0x25')],_0x23d0('0x1c'),(_0x1070b1,_0x1d7396)=>{_0x578ed3[_0x23d0('0x9')](_0x1d7396['id'])&&(_0x578ed3['getSuggestion'](_0x1d7396['id'])[_0x23d0('0x23')]=_0x1d7396[_0x23d0('0x23')]);}),this['_trackChangesService'][_0x23d0('0x24')](_0x367bd1[_0x23d0('0xb')])[_0x23d0('0x6')](_0x23412d=>this['_fetchMissingUsersForThreads'](_0x23412d)[_0x23d0('0x6')](()=>{for(const _0x144260 of _0x23412d){_0x578ed3[_0x23d0('0x11')](_0x144260)[_0x23d0('0x21')]=!0x0;}}));}async[_0x23d0('0x2')](){const _0x51301a=this['editor'][_0x23d0('0x7')][_0x23d0('0x14')]('TrackChangesEditing'),{connection:_0x13ff77}=this[_0x23d0('0xc')]['plugins'][_0x23d0('0x14')](_0x510912),_0x551ba0=await this[_0x23d0('0x25')][_0x23d0('0x24')](_0x13ff77);await this[_0x23d0('0xd')](_0x551ba0);for(const {suggestionData:_0x3273dd,resolve:_0x181e34}of this['_bufferedRequests'][_0x23d0('0x0')]()){let _0x3535ad=_0x551ba0[_0x23d0('0xa')](_0x1f7f32=>_0x1f7f32['id']===_0x3273dd['id']);_0x3535ad||(_0x3535ad=await this[_0x23d0('0x25')][_0x23d0('0x1e')](_0x3273dd['id'],_0x3273dd['type'],_0x3273dd['data'],_0x3273dd[_0x23d0('0x10')])),_0x181e34(_0x3535ad);}for(const _0x28b6d0 of _0x551ba0)_0x51301a[_0x23d0('0x9')](_0x28b6d0['id'])||_0x51301a[_0x23d0('0x11')](_0x28b6d0);}async[_0x23d0('0x1f')](){this[_0x23d0('0x25')]['isConnected']||await new Promise(_0x58726b=>{this[_0x23d0('0x18')](this['_trackChangesService'],_0x23d0('0xf'),_0x124a7f=>{_0x124a7f[_0x23d0('0x1a')](),_0x58726b();});});}[_0x23d0('0xd')](_0x2d880d){const _0x398702=this[_0x23d0('0xc')]['plugins'][_0x23d0('0x14')](_0x4cfe9e),{connection:_0x448017}=this['editor'][_0x23d0('0x7')][_0x23d0('0x14')](_0x510912),_0x3d0cfe=new Set();for(const {authorId:_0x5d1445}of _0x2d880d)_0x398702[_0x23d0('0x13')](_0x5d1445)||_0x3d0cfe[_0x23d0('0x1e')](_0x5d1445);return Promise[_0x23d0('0x22')](Array[_0x23d0('0x20')](_0x3d0cfe)['map'](_0x24d868=>_0x5f4894['get'](_0x448017,_0x24d868)[_0x23d0('0x6')](_0x57d54e=>{_0x398702['getUser'](_0x24d868)||_0x398702['addUser'](_0x57d54e);})));}}function R(_0x33bb1f){if(E(_0x33bb1f))return new Promise(()=>{});throw _0x33bb1f;}function E(_0x245d9e){return _0x245d9e['message'][_0x23d0('0x1b')](_0x23d0('0xe'))||_0x245d9e['message'][_0x23d0('0x1b')](_0x23d0('0x3'));}g[_0x23d0('0x19')]=_0x528765;