/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x27ad=['updateMarker','elementToElement','markerToHighlight','model','comment:','ready','removeCommentThread','markers','change','change:activeMarker','addComment','plugins','differ','add','markerName','editingDowncast','once','isObject','fetchCommentThread','rootName','length','left','for','set','schema','low','conversion','getWalker','isCollapsed','ck-comment-marker','name','end','getAllMarkersForId','reconvertMarker','affectsData','stop','managedUsingOperations','change:isReadOnly','split','view','state','$graveyard','high','_attachThreadToMarker','from','removeMarker','createPositionBefore','_handleMarkerAddAndRemove','listenTo','collaboration.channelId','getCommentThread','text','ck-comment-marker--active','createRange','config','then','CommentsRepository','destroy','has','hasCommentThread','isThreadsLoadingPaused','createElement','getAttribute','destroyed','delete','hasMarkerForId','attachTo','top','editor','document','_detachCommentThread','dataDowncast','get','newRange','_attachedThreads','upcast','root','comment','sort','render','$marker','dataToMarker','editing','activeMarker','CommentsEditing','map','_initializeMarkerConverters','pluginName','isEqual'];(function(_0x42581f,_0x27ad80){const _0x3136ca=function(_0x54cc89){while(--_0x54cc89){_0x42581f['push'](_0x42581f['shift']());}};_0x3136ca(++_0x27ad80);}(_0x27ad,0x17a));const _0x3136=function(_0x42581f,_0x27ad80){_0x42581f=_0x42581f-0x0;let _0x3136ca=_0x27ad[_0x42581f];return _0x3136ca;};import{Plugin as _0x42ab6c}from'ckeditor5/src/core';import{Rect as _0x570c3a}from'ckeditor5/src/utils';import _0x50a161 from'./commentsrepository';import _0x3ae289 from'./addcommentthreadcommand';import{getMarkerDomElement as _0x5b22ba}from'ckeditor5-collaboration/src/collaboration-core';import _0xa26fd0 from'./integrations/commentsrestrictededitingmode';import'../../theme/commentmarker.css';export default class r extends _0x42ab6c{static get['requires'](){return[_0x50a161,_0xa26fd0];}static get[_0x3136('0x41')](){return _0x3136('0x3e');}constructor(_0xb205e0){super(_0xb205e0),this[_0x3136('0x1')](_0x3136('0x26'),!0x0),_0xb205e0['data'][_0x3136('0x53')](_0x3136('0x48'),()=>this[_0x3136('0x26')]=!0x1),this['set'](_0x3136('0x3d'),null),this['on'](_0x3136('0x4c'),(_0x3d16dc,_0x26b1e3,_0x409f39,_0x2479df)=>{_0xb205e0[_0x3136('0x46')]['change'](()=>{if(_0x409f39){const {id:_0x5712b9}=G(_0x409f39),_0x301b5d=this[_0x3136('0xa')](_0x5712b9);for(const _0x170e3f of _0x301b5d)_0xb205e0[_0x3136('0x3c')][_0x3136('0xb')](_0x170e3f);}if(_0x2479df){const {id:_0x47a23f}=G(_0x2479df),_0x233ec5=this[_0x3136('0xa')](_0x47a23f);for(const _0x4bd571 of _0x233ec5)_0xb205e0[_0x3136('0x3c')][_0x3136('0xb')](_0x4bd571);}});}),this['_attachedThreads']=new Set();}['init'](){const _0x1e3711=this['editor'],_0xa97ca1=_0x1e3711[_0x3136('0x4e')][_0x3136('0x32')](_0x3136('0x22')),_0x584b28=_0x1e3711['config'][_0x3136('0x32')](_0x3136('0x1b'));_0x1e3711['commands']['add']('addCommentThread',new _0x3ae289(_0x1e3711)),this[_0x3136('0x1a')](_0x1e3711,_0x3136('0xf'),(_0x2bcbbe,_0x408296,_0xb82cbd)=>{_0xa97ca1['switchReadOnly'](_0xb82cbd,_0x1e3711[_0x3136('0x20')][_0x3136('0x32')](_0x3136('0x1b')));}),this[_0x3136('0x1a')](_0xa97ca1,q(_0x3136('0x49'),_0x584b28),(_0x4b3dbb,{threadId:_0x180074})=>{_0x1e3711['model']['change'](_0x4dfbb9=>{for(const _0x213d0f of this[_0x3136('0xa')](_0x180074))_0x4dfbb9[_0x3136('0x17')](_0x213d0f);});const _0x163ed2=_0xa97ca1[_0x3136('0x1c')](_0x180074);_0xa97ca1[_0x3136('0x25')](_0x180074)&&!_0x163ed2[_0x3136('0x57')]||_0x4b3dbb[_0x3136('0xd')]();},{'priority':_0x3136('0x14')}),this[_0x3136('0x1a')](_0xa97ca1,q(_0x3136('0x4d'),_0x584b28),(_0x43f5cf,{threadId:_0x300385,isFromAdapter:_0x211da6})=>{const _0xa0abee=this[_0x3136('0xa')](_0x300385);if(_0x211da6||0x0==_0xa0abee[_0x3136('0x57')]||!_0xa97ca1[_0x3136('0x25')](_0x300385))return;0x1===_0xa97ca1['getCommentThread'](_0x300385)['length']&&_0x1e3711[_0x3136('0x46')][_0x3136('0x4b')](_0x1960c7=>{for(const _0x3953d7 of _0xa0abee)_0x1960c7[_0x3136('0x43')](_0x3953d7,{'usingOperation':!0x0,'affectsData':!0x0});});},{'priority':_0x3136('0x3')}),this[_0x3136('0x40')](),this[_0x3136('0x19')]();}[_0x3136('0x23')](){const _0x13cead=this[_0x3136('0x2e')][_0x3136('0x4e')]['get'](_0x3136('0x22')),_0x245bc0=this[_0x3136('0x2e')][_0x3136('0x20')][_0x3136('0x32')](_0x3136('0x1b'));for(const _0x41cc4d of _0x13cead['getCommentThreads']({'channelId':_0x245bc0}))_0x13cead[_0x3136('0x30')](_0x41cc4d['id']),_0x13cead['_threads'][_0x3136('0x2a')](_0x41cc4d['id']);super[_0x3136('0x23')]();}[_0x3136('0x2b')](_0x154df8){return this[_0x3136('0xa')](_0x154df8)[_0x3136('0x57')]>0x0;}[_0x3136('0xa')](_0x3560cd){const _0x412678=this[_0x3136('0x2e')][_0x3136('0x46')][_0x3136('0x4a')][_0x3136('0x32')]('comment:'+_0x3560cd);return _0x412678?[_0x412678]:Array[_0x3136('0x16')](this[_0x3136('0x2e')]['model'][_0x3136('0x4a')]['getMarkersGroup'](_0x3136('0x47')+_0x3560cd));}[_0x3136('0x40')](){const _0x1f0e75=this[_0x3136('0x2e')];_0x1f0e75[_0x3136('0x4')][_0x3136('0x0')](_0x3136('0x52'))[_0x3136('0x45')]({'model':_0x3136('0x37'),'view':_0x13b594=>{const {id:_0x25d5bc}=G(_0x13b594[_0x3136('0x51')]),_0x2b1b04=[_0x3136('0x7')];return this[_0x3136('0x3d')]&&G(this[_0x3136('0x3d')])['id']===_0x25d5bc&&_0x2b1b04['push'](_0x3136('0x1e')),{'classes':_0x2b1b04,'attributes':{'data-comment':_0x25d5bc}};}}),_0x1f0e75[_0x3136('0x4')][_0x3136('0x0')](_0x3136('0x31'))['markerToData']({'model':_0x3136('0x37'),'view':_0x1d8a7e=>{const _0x5ab987=_0x1f0e75['model']['markers'][_0x3136('0x32')](_0x1d8a7e),{id:_0x42055d,part:_0x4a9f40}=G(_0x1d8a7e);return _0x5ab987&&!_0x5ab987[_0x3136('0xc')]?null:{'group':_0x3136('0x37'),'name':_0x4a9f40?_0x42055d+':'+_0x4a9f40:_0x42055d};}}),_0x1f0e75[_0x3136('0x4')][_0x3136('0x0')](_0x3136('0x35'))[_0x3136('0x44')]({'view':{'name':_0x3136('0x37'),'attribute':{'id':/^\w/}},'model':(_0x868f96,{writer:_0x5e2bbd})=>_0x5e2bbd[_0x3136('0x27')](_0x3136('0x3a'),{'data-name':_0x3136('0x47')+_0x868f96[_0x3136('0x28')]('id')})}),_0x1f0e75[_0x3136('0x4')][_0x3136('0x0')](_0x3136('0x35'))[_0x3136('0x3b')]({'view':_0x3136('0x37')});}['_handleMarkerAddAndRemove'](){const _0x238bdc=this[_0x3136('0x2e')],_0x4b8b7f=_0x238bdc[_0x3136('0x4e')][_0x3136('0x32')](_0x3136('0x22')),_0x2ffba7=new Set();_0x238bdc[_0x3136('0x46')][_0x3136('0x2f')]['registerPostFixer'](_0x63252c=>{let _0x333f0f=!0x1;for(const {name:_0x2238ef,data:_0x3a962f}of _0x238bdc[_0x3136('0x46')][_0x3136('0x2f')][_0x3136('0x4f')]['getChangedMarkers']()){const {group:_0x256609,id:_0x58d5d8}=G(_0x2238ef);let _0x1ace98=_0x3a962f[_0x3136('0x33')];if(_0x3136('0x37')!==_0x256609||!_0x1ace98)continue;const _0x177957=_0x3136('0x13')===_0x1ace98[_0x3136('0x36')][_0x3136('0x56')];_0x177957||(_0x1ace98=J(_0x1ace98,_0x238bdc['model']),!_0x1ace98||_0x1ace98[_0x3136('0x42')](_0x3a962f['newRange']))?!_0x1ace98||!_0x238bdc[_0x3136('0x46')]['hasContent'](_0x1ace98)||this['_attachedThreads'][_0x3136('0x24')](_0x58d5d8)&&_0x177957?(_0x63252c['removeMarker'](_0x2238ef),_0x333f0f=!0x0):_0x177957||(this[_0x3136('0x26')]?_0x2ffba7[_0x3136('0x50')](_0x58d5d8):this[_0x3136('0x15')](_0x58d5d8)):(_0x63252c[_0x3136('0x43')](_0x2238ef,{'range':_0x1ace98}),_0x333f0f=!0x0);}return _0x333f0f;}),this['on']('change:isThreadsLoadingPaused',(_0x2a8618,_0x2112e8,_0x17f8ae)=>{if(!_0x17f8ae&&_0x2ffba7['size'])for(const _0x4cd5e8 of _0x2ffba7)this['_attachThreadToMarker'](_0x4cd5e8),_0x2ffba7[_0x3136('0x2a')](_0x4cd5e8);}),this['listenTo'](_0x238bdc['model'][_0x3136('0x4a')],'update:comment',(_0x2c388a,_0x5989ad,_0x3fa86f,_0x86b2a5)=>{if(_0x86b2a5)return;const {id:_0x31469b}=G(_0x5989ad[_0x3136('0x8')]),_0x3e9c41=_0x238bdc[_0x3136('0x4e')][_0x3136('0x32')]('CommentsRepository')[_0x3136('0x1c')](_0x31469b);_0x2ffba7[_0x3136('0x2a')](_0x31469b),_0x3e9c41&&!this[_0x3136('0x2b')](_0x31469b)&&(this[_0x3136('0x34')][_0x3136('0x2a')](_0x31469b),_0x4b8b7f['_detachCommentThread'](_0x31469b));});}[_0x3136('0x15')](_0x955d76){if(this[_0x3136('0x34')][_0x3136('0x24')](_0x955d76))return;this[_0x3136('0x34')][_0x3136('0x50')](_0x955d76);const _0x167e19=this[_0x3136('0x2e')],_0x40af66=_0x167e19[_0x3136('0x4e')]['get'](_0x3136('0x22')),_0x269214=_0x167e19['config'][_0x3136('0x32')](_0x3136('0x1b')),_0x903a3b=()=>{const _0x22caac=this[_0x3136('0xa')](_0x955d76);if(0x0==_0x22caac[_0x3136('0x57')])return null;const _0x4eb714=_0x22caac[_0x3136('0x3f')](_0x2361ef=>_0x5b22ba(_0x167e19[_0x3136('0x3c')],_0x2361ef));return _0x4eb714[_0x3136('0x38')]((_0x25eef4,_0x48806d)=>{const _0x3a39a3=new _0x570c3a(_0x25eef4),_0x287f94=new _0x570c3a(_0x48806d),_0xaca8f9=_0x3a39a3['top']-_0x287f94[_0x3136('0x2d')];return 0x0==_0xaca8f9?_0x3a39a3[_0x3136('0x58')]-_0x287f94[_0x3136('0x58')]:_0xaca8f9;}),_0x4eb714[0x0];};!this[_0x3136('0xa')](_0x955d76)[0x0][_0x3136('0xe')]?_0x167e19[_0x3136('0x3c')][_0x3136('0x11')][_0x3136('0x53')](_0x3136('0x39'),()=>{_0x40af66['openNewCommentThread']({'channelId':_0x269214,'threadId':_0x955d76,'target':_0x903a3b});},{'priority':_0x3136('0x3')}):_0x40af66[_0x3136('0x55')]({'channelId':_0x269214,'threadId':_0x955d76})[_0x3136('0x21')](_0x46d831=>{if(_0x3136('0x29')!==_0x167e19[_0x3136('0x12')]){if(_0x46d831)_0x46d831[_0x3136('0x2c')](_0x903a3b);else{const _0x1fe0d9=this['getAllMarkersForId'](_0x955d76);_0x167e19['model'][_0x3136('0x4b')](_0x5abae6=>{for(const _0x5f0e7f of _0x1fe0d9)_0x5abae6[_0x3136('0x17')](_0x5f0e7f);});}}});}}function q(_0x5f1e4a,_0x3d3220){return _0x3d3220?_0x5f1e4a+':'+_0x3d3220:_0x5f1e4a;}function G(_0x5330a2){const _0x3d131a=_0x5330a2[_0x3136('0x10')](':');return{'group':_0x3d131a[0x0],'id':_0x3d131a[0x1],'part':_0x3d131a[0x2]};}function J(_0x3afe12,_0x964518){const _0x39e843=_0x964518[_0x3136('0x2')],_0x220814=_0x964518[_0x3136('0x1f')](_0x3afe12['start']);for(const _0x4277da of _0x3afe12[_0x3136('0x5')]()){const {type:_0x57dd1b,item:_0x35590a,nextPosition:_0x4a50d4}=_0x4277da;if(_0x3136('0x1d')===_0x57dd1b||_0x39e843[_0x3136('0x54')](_0x35590a)){const _0x15f363=_0x964518[_0x3136('0x18')](_0x35590a);_0x220814[_0x3136('0x6')]&&(_0x220814['start']=_0x15f363),_0x220814[_0x3136('0x9')]=_0x4a50d4;}}return _0x220814[_0x3136('0x6')]?null:_0x220814;}