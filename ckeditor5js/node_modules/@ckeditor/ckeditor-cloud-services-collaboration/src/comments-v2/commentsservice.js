/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2670b8,_0x4bfb56,_0x285f72,_0x2d2f96){void 0x0===_0x2d2f96&&(_0x2d2f96=_0x285f72),Object['defineProperty'](_0x2670b8,_0x2d2f96,{'enumerable':!0x0,'get':function(){return _0x4bfb56[_0x285f72];}});}:function(_0x3e82ac,_0x1a6941,_0x55ab34,_0x1229fe){void 0x0===_0x1229fe&&(_0x1229fe=_0x55ab34),_0x3e82ac[_0x1229fe]=_0x1a6941[_0x55ab34];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x27ce92,_0x40bc4c){Object['defineProperty'](_0x27ce92,'default',{'enumerable':!0x0,'value':_0x40bc4c});}:function(_0x2eb4e7,_0x5d5801){_0x2eb4e7['default']=_0x5d5801;}),__importStar=this&&this['__importStar']||function(_0x4e45cc){if(_0x4e45cc&&_0x4e45cc['__esModule'])return _0x4e45cc;var _0x313cee={};if(null!=_0x4e45cc)for(var _0xb58894 in _0x4e45cc)'default'!==_0xb58894&&Object['prototype']['hasOwnProperty']['call'](_0x4e45cc,_0xb58894)&&__createBinding(_0x313cee,_0x4e45cc,_0xb58894);return __setModuleDefault(_0x313cee,_0x4e45cc),_0x313cee;},__importDefault=this&&this['__importDefault']||function(_0xe6d066){return _0xe6d066&&_0xe6d066['__esModule']?_0xe6d066:{'default':_0xe6d066};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addcommentmessage_1=__importDefault(require('./messages/addcommentmessage')),addcommentresponse_1=__importDefault(require('./responses/addcommentresponse')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),removecommentmessage_1=__importDefault(require('./messages/removecommentmessage')),removecommentthreadmessage_1=__importDefault(require('./messages/removecommentthreadmessage')),updatecommentmessage_1=__importDefault(require('./messages/updatecommentmessage')),getcommentthreadmessage_1=__importDefault(require('./messages/getcommentthreadmessage')),getcommentthreadresponse_1=__importDefault(require('./responses/getcommentthreadresponse')),getdocumentthreadsmessage_1=__importDefault(require('./messages/getdocumentthreadsmessage')),getdocumentthreadsresponse_1=__importDefault(require('./responses/getdocumentthreadsresponse')),websocketgateway_1=__importStar(require('./../websocketgateway/websocketgateway')),ckeditorcloudserviceserror_1=__importDefault(require('./../ckeditorcloudserviceserror')),sessions_1=__importDefault(require('../sessions/sessions')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror'));exports['_SERVICE']=0x9;class CommentsService{constructor(_0x3d3abf){this['_documentId']=_0x3d3abf,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x3c5b43){if(this['_isConnected'])return;if(_0x3c5b43['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x3c5b43);const _0x3a43c1=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x3c5b43,this['stopListening'](_0x3c5b43,'change:state');const _0xbcd3a7=await _0x3c5b43['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x3a43c1)),{channel:channel,threads:threads}=messagescompressor_1['default']['decode'](_0xbcd3a7,connectresponse_1['default']);return this['listenTo'](_0x3c5b43,'change:state',(_0xab5a16,_0x11f3b7,_0x62c4)=>this['_onWsGatewayStateChange'](_0x62c4),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x3c5b43,channel),this['_isConnected']=!0x0,this['fire']('connected'),threads;}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['_connectedSessions']&&(this['_connectedSessions']['disconnect'](),this['_connectedSessions']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['addComment'](_0x477ea1,_0x2f6cc8,_0x50a1bd,_0x19f8a4){const _0x1ef3bb=new addcommentmessage_1['default'](this['_documentId'],_0x477ea1,_0x50a1bd,_0x2f6cc8,void 0x0,void 0x0,_0x19f8a4),_0x18be2d=await this['_sendRequest'](addcommentmessage_1['default']['TYPE'],_0x1ef3bb);return messagescompressor_1['default']['decode'](_0x18be2d,addcommentresponse_1['default']);}async['updateComment'](_0x7a1df6,_0x17cc04,_0xf4c137,_0x31ce25){const _0x588d1c=void 0x0!==_0x31ce25,_0x1885c1=new updatecommentmessage_1['default'](this['_documentId'],_0x7a1df6,_0x17cc04,_0xf4c137,_0x31ce25,_0x588d1c);await this['_sendRequest'](updatecommentmessage_1['default']['TYPE'],_0x1885c1);}async['removeComment'](_0x1ee1e2,_0x2ffac7){const _0x52aed6=new removecommentmessage_1['default'](this['_documentId'],_0x1ee1e2,_0x2ffac7);await this['_sendRequest'](removecommentmessage_1['default']['TYPE'],_0x52aed6);}async['removeCommentThread'](_0x5155e9){const _0xdfca3d=new removecommentthreadmessage_1['default'](this['_documentId'],_0x5155e9);await this['_sendRequest'](removecommentthreadmessage_1['default']['TYPE'],_0xdfca3d);}async['getCommentThread'](_0x18ac15,_0x2ddd00=0x1){const _0x5d0f94=new getcommentthreadmessage_1['default'](_0x18ac15,this['_documentId']);try{const _0x949b89=await this['_sendRequest'](getcommentthreadmessage_1['default']['TYPE'],_0x5d0f94),{comments:comments,commentThreadId:_0x2f073f}=messagescompressor_1['default']['decode'](_0x949b89,getcommentthreadresponse_1['default']);return{'comments':comments,'commentThreadId':_0x2f073f};}catch(_0x31e2c8){if(_0x31e2c8 instanceof ckeditorcloudservicesservererror_1['default']&&'404'===_0x31e2c8['code']&&_0x2ddd00<0x5)return await(_0x1e3ba4=0x64*_0x2ddd00,new Promise(_0x33fa2a=>{setTimeout(_0x33fa2a,_0x1e3ba4);})),this['getCommentThread'](_0x18ac15,_0x2ddd00+0x1);if(_0x31e2c8 instanceof ckeditorcloudservicesservererror_1['default'])throw _0x31e2c8;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x31e2c8);}var _0x1e3ba4;}async['getDocumentThreads'](){const _0x1cbe88=new getdocumentthreadsmessage_1['default'](this['_documentId']),_0x3dc8ec=await this['_sendRequest'](getdocumentthreadsmessage_1['default']['TYPE'],_0x1cbe88),{threads:threads}=messagescompressor_1['default']['decode'](_0x3dc8ec,getdocumentthreadsresponse_1['default']);return{'threads':threads};}async['getConnectedSessions'](){if(!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_connectedSessions']||(this['_connectedSessions']=await sessions_1['default']['getConnectedSessions'](this['_wsGateway'],this['_documentId'],exports['_SERVICE'])),this['_connectedSessions'];}['_connectToChannel'](_0x13254e,_0x2f2420){this['_channel']=_0x13254e['_getChannel'](CommentsService['_SERVICE'],_0x2f2420),this['_channel']&&(this['listenTo'](this['_channel'],this['_channel']['getEventName'](addcommentmessage_1['default']['TYPE']),(_0x5c8fcf,_0x282ae2)=>{const _0x1b9c14=messagescompressor_1['default']['decode'](_0x282ae2,addcommentmessage_1['default']);this['fire']('commentAdded',_0x1b9c14);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentmessage_1['default']['TYPE']),(_0x2c7e11,_0x2de124)=>{const _0x3d53cd=messagescompressor_1['default']['decode'](_0x2de124,removecommentmessage_1['default']);this['fire']('commentRemoved',_0x3d53cd);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatecommentmessage_1['default']['TYPE']),(_0x51fd6c,_0x295fd4)=>{const _0x43d7be=messagescompressor_1['default']['decode'](_0x295fd4,updatecommentmessage_1['default']);this['fire']('commentUpdated',_0x43d7be);}),this['listenTo'](this['_channel'],this['_channel']['getEventName'](removecommentthreadmessage_1['default']['TYPE']),(_0x49a4e4,_0x2736f1)=>{const _0x4f98c5=messagescompressor_1['default']['decode'](_0x2736f1,removecommentthreadmessage_1['default']);this['fire']('commentThreadRemoved',_0x4f98c5);}));}['_onWsGatewayStateChange'](_0x4d16d5){_0x4d16d5===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x117abb,_0x209700){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Comments',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x117abb,messagescompressor_1['default']['encode'](_0x209700));}}CommentsService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(CommentsService,utils_1['EmitterMixin']),exports['default']=CommentsService;