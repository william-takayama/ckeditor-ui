/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x2a62f3,_0x5f2bf5,_0x13eccc,_0x12b046){void 0x0===_0x12b046&&(_0x12b046=_0x13eccc),Object['defineProperty'](_0x2a62f3,_0x12b046,{'enumerable':!0x0,'get':function(){return _0x5f2bf5[_0x13eccc];}});}:function(_0x1790cc,_0x5bbac9,_0xd10c13,_0x3d8e2f){void 0x0===_0x3d8e2f&&(_0x3d8e2f=_0xd10c13),_0x1790cc[_0x3d8e2f]=_0x5bbac9[_0xd10c13];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x2e686e,_0x1a5ad1){Object['defineProperty'](_0x2e686e,'default',{'enumerable':!0x0,'value':_0x1a5ad1});}:function(_0x581e5f,_0xa1392e){_0x581e5f['default']=_0xa1392e;}),__importStar=this&&this['__importStar']||function(_0x4c4982){if(_0x4c4982&&_0x4c4982['__esModule'])return _0x4c4982;var _0x122abd={};if(null!=_0x4c4982)for(var _0x23d0c6 in _0x4c4982)'default'!==_0x23d0c6&&Object['prototype']['hasOwnProperty']['call'](_0x4c4982,_0x23d0c6)&&__createBinding(_0x122abd,_0x4c4982,_0x23d0c6);return __setModuleDefault(_0x122abd,_0x4c4982),_0x122abd;},__importDefault=this&&this['__importDefault']||function(_0xf0a232){return _0xf0a232&&_0xf0a232['__esModule']?_0xf0a232:{'default':_0xf0a232};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),revisionhistorygetrevisionmessage_1=__importDefault(require('./messages/revisionhistorygetrevisionmessage')),revisionhistorygetrevisionresponse_1=__importDefault(require('./responses/revisionhistorygetrevisionresponse')),revisionhistoryupdaterevisionsmessage_1=__importDefault(require('./messages/revisionhistoryupdaterevisionsmessage')),revisionhistoryupdaterevisionsresponse_1=__importDefault(require('./responses/revisionhistoryupdaterevisionsresponse')),revisionhistoryconnectmessage_1=__importDefault(require('./messages/revisionhistoryconnectmessage')),revisionhistoryconnectresponse_1=__importDefault(require('./responses/revisionhistoryconnectresponse')),revisionhistoryreconnectmessage_1=__importDefault(require('./messages/revisionhistoryreconnectmessage')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError'));exports['_SERVICE']=0xc;class RevisionHistoryService{constructor(_0x4465a7){this['_documentId']=_0x4465a7,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}['connect'](_0x255cca){return this['_isConnected']?Promise['resolve']():this['_connect'](_0x255cca,new revisionhistoryconnectmessage_1['default'](this['_documentId']));}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}['reconnect'](_0x3bc6b7,_0x4e5e49){if(this['isConnected'])throw new ckeditorcloudserviceserror_1['default']('Cannot\x20reconnect\x20to\x20already\x20connected\x20service.',_0x3bc6b7);return this['_connect'](_0x3bc6b7,new revisionhistoryreconnectmessage_1['default'](this['_documentId'],_0x4e5e49));}async['updateRevisions'](_0x554ed1,_0x3798cf){const _0x18d725=revisionhistoryupdaterevisionsmessage_1['default']['create']({'documentId':this['_documentId'],'requestId':_0x3798cf,'revisions':_0x554ed1}),_0x2884a1=await this['_sendRequest'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE'],_0x18d725),{requestId:requestId}=messagescompressor_1['default']['decode'](_0x2884a1,revisionhistoryupdaterevisionsresponse_1['default']);return requestId;}async['getRevision'](_0x51f4f5){const _0x263c76=new revisionhistorygetrevisionmessage_1['default'](this['_documentId'],_0x51f4f5),_0x2c9b2d=await this['_sendRequest'](revisionhistorygetrevisionmessage_1['default']['TYPE'],_0x263c76);return messagescompressor_1['default']['decode'](_0x2c9b2d,revisionhistorygetrevisionresponse_1['default'])['toObject']();}async['_connect'](_0x482444,_0x464153){if(_0x482444['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x482444);this['_wsGateway']=_0x482444,this['stopListening'](_0x482444,'change:state');const _0x2e19a6=await _0x482444['_sendRequest'](exports['_SERVICE'],_0x464153['constructor']['TYPE'],messagescompressor_1['default']['encode'](_0x464153)),{channel:channel,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x2e19a6,revisionhistoryconnectresponse_1['default'])['toObject']();return this['listenTo'](_0x482444,'change:state',(_0x133c53,_0x431e94,_0x1b99fb)=>this['_onWsGatewayStateChange'](_0x1b99fb),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x482444,channel),this['_isConnected']=!0x0,this['fire']('connected'),{'revisions':revisions,'requestId':requestId};}['_connectToChannel'](_0x12bcfa,_0x414f9c){this['_channel']=_0x12bcfa['_getChannel'](RevisionHistoryService['_SERVICE'],_0x414f9c),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](revisionhistoryupdaterevisionsmessage_1['default']['TYPE']),(_0x19b60a,_0x4b75b6)=>{const {documentId:documentId,requestId:requestId,revisions:revisions}=messagescompressor_1['default']['decode'](_0x4b75b6,revisionhistoryupdaterevisionsmessage_1['default'])['toObject']();this['fire']('revisionsUpdated',{'documentId':documentId,'requestId':requestId,'revisionsData':revisions});});}['_onWsGatewayStateChange'](_0x2cf8f4){_0x2cf8f4===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x257fb6,_0x1c4bd9){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Revision\x20History',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x257fb6,messagescompressor_1['default']['encode'](_0x1c4bd9));}}RevisionHistoryService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(RevisionHistoryService,utils_1['EmitterMixin']),exports['default']=RevisionHistoryService;