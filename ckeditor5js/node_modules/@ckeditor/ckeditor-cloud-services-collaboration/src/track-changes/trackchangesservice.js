/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
'use strict';var __createBinding=this&&this['__createBinding']||(Object['create']?function(_0x380c11,_0x439fbb,_0x7afd3a,_0x4b381a){void 0x0===_0x4b381a&&(_0x4b381a=_0x7afd3a),Object['defineProperty'](_0x380c11,_0x4b381a,{'enumerable':!0x0,'get':function(){return _0x439fbb[_0x7afd3a];}});}:function(_0x535ff5,_0x5036c7,_0x4f78d6,_0x2064ce){void 0x0===_0x2064ce&&(_0x2064ce=_0x4f78d6),_0x535ff5[_0x2064ce]=_0x5036c7[_0x4f78d6];}),__setModuleDefault=this&&this['__setModuleDefault']||(Object['create']?function(_0x188be2,_0x16b473){Object['defineProperty'](_0x188be2,'default',{'enumerable':!0x0,'value':_0x16b473});}:function(_0x40eea8,_0x9be41c){_0x40eea8['default']=_0x9be41c;}),__importStar=this&&this['__importStar']||function(_0x4427e2){if(_0x4427e2&&_0x4427e2['__esModule'])return _0x4427e2;var _0x249d07={};if(null!=_0x4427e2)for(var _0x2d1373 in _0x4427e2)'default'!==_0x2d1373&&Object['prototype']['hasOwnProperty']['call'](_0x4427e2,_0x2d1373)&&__createBinding(_0x249d07,_0x4427e2,_0x2d1373);return __setModuleDefault(_0x249d07,_0x4427e2),_0x249d07;},__importDefault=this&&this['__importDefault']||function(_0x2963ce){return _0x2963ce&&_0x2963ce['__esModule']?_0x2963ce:{'default':_0x2963ce};};Object['defineProperty'](exports,'__esModule',{'value':!0x0}),exports['_SERVICE']=void 0x0;const utils_1=require('ckeditor5/src/utils'),messagescompressor_1=__importDefault(require('./../messagescompressor')),addsuggestionmessage_1=__importDefault(require('./messages/addsuggestionmessage')),addsuggestionresponse_1=__importDefault(require('./responses/addsuggestionresponse')),getsuggestionmessage_1=__importDefault(require('./messages/getsuggestionmessage')),getsuggestionresponse_1=__importDefault(require('./responses/getsuggestionresponse')),getallsuggestionsmessage_1=__importDefault(require('./messages/getallsuggestionsmessage')),getallsuggestionsresponse_1=__importDefault(require('./responses/getallsuggestionsresponse')),updatesuggestionmessage_1=__importDefault(require('./messages/updatesuggestionmessage')),connectmessage_1=__importDefault(require('./messages/connectmessage')),connectresponse_1=__importDefault(require('./responses/connectresponse')),ckeditorcloudserviceserror_1=__importDefault(require('../ckeditorcloudserviceserror')),websocketgateway_1=__importStar(require('../websocketgateway/websocketgateway')),ServiceNotConnectedError_1=__importDefault(require('../errors/ServiceNotConnectedError')),ckeditorcloudservicesservererror_1=__importDefault(require('../ckeditorcloudservicesservererror'));exports['_SERVICE']=0xa;class TrackChangesService{constructor(_0x1e1dd4){this['_documentId']=_0x1e1dd4,this['_isConnected']=!0x1;}get['isConnected'](){return this['_isConnected'];}async['connect'](_0x3d1261){if(this['_isConnected'])return;if(_0x3d1261['state']!==websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['CONNECTED'])throw new ckeditorcloudserviceserror_1['default']('WebSocket\x20Gateway\x20is\x20not\x20connected.',_0x3d1261);const _0x28be12=new connectmessage_1['default'](this['_documentId']);this['_wsGateway']=_0x3d1261,this['stopListening'](_0x3d1261,'change:state');const _0x2dacc1=await _0x3d1261['_sendRequest'](exports['_SERVICE'],connectmessage_1['default']['TYPE'],messagescompressor_1['default']['encode'](_0x28be12)),_0xf6f4eb=messagescompressor_1['default']['decode'](_0x2dacc1,connectresponse_1['default']);return this['listenTo'](_0x3d1261,'change:state',(_0x4ee33e,_0x212d8a,_0x13cd26)=>this['_onWsGatewayStateChange'](_0x13cd26),{'priority':websocketgateway_1['default']['_CHANGE_STATE_EVENT_PRIORITY']}),this['_connectToChannel'](_0x3d1261,_0xf6f4eb['channel']),this['_isConnected']=!0x0,this['fire']('connected'),_0xf6f4eb['suggestions'];}['disconnect'](){this['_isConnected']&&(this['_isConnected']=!0x1,this['_wsGateway']&&(this['stopListening'](this['_wsGateway']),this['_wsGateway']=void 0x0),this['_channel']&&(this['stopListening'](this['_channel']),this['_channel']=void 0x0),this['fire']('disconnected'),this['stopListening']());}async['add'](_0x4146bd,_0x3bb9c8,_0x246895,_0xdbbd81=null,_0x22350a){const _0x54604e=new addsuggestionmessage_1['default'](_0x4146bd,this['_documentId'],_0x3bb9c8,_0x246895,_0xdbbd81,_0x22350a),_0x1013ed=await this['_sendRequest'](addsuggestionmessage_1['default']['TYPE'],_0x54604e);return messagescompressor_1['default']['decode'](_0x1013ed,addsuggestionresponse_1['default']);}async['get'](_0x1864e2,_0x901d54=0x1){const _0x1cd062=new getsuggestionmessage_1['default'](_0x1864e2,this['_documentId']);try{const _0x2d1efb=await this['_sendRequest'](getsuggestionmessage_1['default']['TYPE'],_0x1cd062);return messagescompressor_1['default']['decode'](_0x2d1efb,getsuggestionresponse_1['default']);}catch(_0x21d8a0){if(_0x21d8a0 instanceof ckeditorcloudservicesservererror_1['default']&&'404'===_0x21d8a0['code']&&_0x901d54<0x5)return await(_0x4432e5=0x64*_0x901d54,new Promise(_0x1dfa3f=>{setTimeout(_0x1dfa3f,_0x4432e5);})),this['get'](_0x1864e2,_0x901d54+0x1);if(_0x21d8a0 instanceof ckeditorcloudservicesservererror_1['default'])throw _0x21d8a0;throw ckeditorcloudservicesservererror_1['default']['fromPublicError'](_0x21d8a0);}var _0x4432e5;}async['getAll'](){const _0x5d35d=new getallsuggestionsmessage_1['default'](this['_documentId']),_0x333810=await this['_sendRequest'](getallsuggestionsmessage_1['default']['TYPE'],_0x5d35d),{suggestions:suggestions}=messagescompressor_1['default']['decode'](_0x333810,getallsuggestionsresponse_1['default']);return suggestions;}async['update'](_0x52bc5e,_0x4671d1={}){const {hasComments:hasComments,state:state,attributes:attributes}=_0x4671d1,_0x4760cd=void 0x0!==hasComments,_0x2502ef=new updatesuggestionmessage_1['default'](_0x52bc5e,this['_documentId'],hasComments,_0x4760cd,state,attributes);await this['_sendRequest'](updatesuggestionmessage_1['default']['TYPE'],_0x2502ef);}['_connectToChannel'](_0x2df46b,_0x7b2cd2){this['_channel']=_0x2df46b['_getChannel'](TrackChangesService['_SERVICE'],_0x7b2cd2),this['_channel']&&this['listenTo'](this['_channel'],this['_channel']['getEventName'](updatesuggestionmessage_1['default']['TYPE']),(_0x4a58f3,_0x5e21e2)=>{const _0x733883=messagescompressor_1['default']['decode'](_0x5e21e2,updatesuggestionmessage_1['default']);this['fire']('suggestionUpdated',_0x733883);});}['_onWsGatewayStateChange'](_0x2452b6){_0x2452b6===websocketgateway_1['WEB_SOCKET_GATEWAY_STATES']['DISCONNECTED']&&this['disconnect']();}['_sendRequest'](_0x1b37f3,_0x2ba44a){if(!this['_wsGateway']||!this['_isConnected'])throw new ServiceNotConnectedError_1['default']('Track\x20Changes',this);return this['_wsGateway']['_sendRequest'](exports['_SERVICE'],_0x1b37f3,messagescompressor_1['default']['encode'](_0x2ba44a));}}TrackChangesService['_SERVICE']=exports['_SERVICE'],(0x0,utils_1['mix'])(TrackChangesService,utils_1['EmitterMixin']),exports['default']=TrackChangesService;