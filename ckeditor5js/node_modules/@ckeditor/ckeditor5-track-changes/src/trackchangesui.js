/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x1ba3=['_createUIButton','change:previous','getRange','_disableComments','_viewToController','discardSuggestion','comments.maxThreadTotalWeight','reduce','actionView','PENDING_ACTION_SUGGESTION','PendingActions','isMultiRange','toMany','values','buttonView','head','getSuggestion','commands','source','destroy','Discard\x20all\x20suggestions','config','getAllAdjacentSuggestions','locale','createCommentThreadController','push','trackChanges.disableComments','_debouncedHandlers','getContainedElement','get','_updateController','requires','commentThread','unbind','change:isDirty','define','plugins','_destroyController','TrackChangesEditing','comments','filter','acceptAllSuggestions','some','from','_suggestionToController','suggestionUnloaded','set','acceptSuggestion','hasSuggestion','arrowView','suggestion-','discardSelectedSuggestions','remove','length','Accept\x20all\x20selected\x20suggestions','descriptionParts','model','Annotations','_descriptionFactory','map','SuggestionThreadView','type','CommentView','change:activeAnnotations','getJoined','componentFactory','view','addSourceCollector','CommentsRepository','getByInnerView','isInContent','comments.maxCommentCharsWhenCollapsed','lowest','clear','acceptSelectedSuggestions','bind','isOn','TrackChangesUI','getRanges','cancel','comments.maxCommentsWhenCollapsed','switchbutton','keys','createAnnotation','_initializeController','separator','add','refreshSelectedViews','trackChanges.SuggestionThreadView','value','editing','listenTo','Discard\x20all\x20selected\x20suggestions','isEnabled','trackChanges','Track\x20changes','editor','pluginName','toViewElement','focus','EditorAnnotations','suggestionLoaded','delete','button','has','activeMarkers','commandName','previous'];(function(_0x3c00bd,_0x1ba3b9){const _0x5d3cdb=function(_0x137282){while(--_0x137282){_0x3c00bd['push'](_0x3c00bd['shift']());}};_0x5d3cdb(++_0x1ba3b9);}(_0x1ba3,0x160));const _0x5d3c=function(_0x3c00bd,_0x1ba3b9){_0x3c00bd=_0x3c00bd-0x0;let _0x5d3cdb=_0x1ba3[_0x3c00bd];return _0x5d3cdb;};import{Plugin as _0x5a479b}from'ckeditor5/src/core';import{Collection as _0x313930}from'ckeditor5/src/utils';import{Model as _0x1d2067,SplitButtonView as _0x41a99c,createDropdown as _0x147936,addListToDropdown as _0x4487f7}from'ckeditor5/src/ui';import{Users as _0x2478e6,getDateTimeFormatter as _0x47490d,getMarkerDomElement as _0x1087df}from'ckeditor5-collaboration/src/collaboration-core';import{debounce as _0x31062d}from'lodash-es';import _0x4d5edd from'./trackchangesediting';import _0x379cfd from'./ui/suggestioncontroller';import _0xd0e20d from'./ui/view/suggestionthreadview';import{getTranslation as _0x467748}from'./utils/common-translations';import _0x58d7bf from'../theme/icons/track-changes.svg';export default class m extends _0x5a479b{static get[_0x5d3c('0x3')](){return[_0x4d5edd,_0x2478e6,_0x5d3c('0x28'),'Annotations',_0x5d3c('0x48')];}static get[_0x5d3c('0x45')](){return _0x5d3c('0x31');}constructor(_0x2a3990){super(_0x2a3990),this['_suggestionToController']=new Map(),this[_0x5d3c('0x54')]=new Map(),this['_debouncedHandlers']=new Map();const _0x772a97=this['editor']['config'];_0x772a97['define'](_0x5d3c('0x3c'),_0xd0e20d),_0x772a97[_0x5d3c('0x7')](_0x5d3c('0x6a'),!0x1),this[_0x5d3c('0x53')]=_0x772a97[_0x5d3c('0x1')]('trackChanges.disableComments');}['init'](){const _0x360c4a=this[_0x5d3c('0x44')],_0x28bbaf=_0x360c4a[_0x5d3c('0x8')][_0x5d3c('0x1')](_0x4d5edd),_0x4e653c=_0x360c4a[_0x5d3c('0x8')][_0x5d3c('0x1')]('Annotations'),_0x4a59b6=_0x360c4a[_0x5d3c('0x8')][_0x5d3c('0x1')]('EditorAnnotations'),_0x572138=_0x360c4a[_0x5d3c('0x8')][_0x5d3c('0x1')](_0x5d3c('0x28'));_0x360c4a['ui'][_0x5d3c('0x25')][_0x5d3c('0x3a')](_0x5d3c('0x42'),_0x21db2e=>this[_0x5d3c('0x50')](_0x21db2e)),_0x4a59b6[_0x5d3c('0x27')](()=>{const _0x4ec843=[];for(const [_0x176194,_0x49d29a]of Array[_0x5d3c('0xf')](this[_0x5d3c('0x10')])){const _0x500f7c=_0x176194[_0x5d3c('0x66')](),_0xc33e03=[];for(const _0x502f5b of _0x500f7c){if(!_0x502f5b[_0x5d3c('0x2a')])continue;if(_0x502f5b[_0x5d3c('0x5b')]){_0xc33e03['push'](..._0x502f5b[_0x5d3c('0x32')]());continue;}const _0x5822f3=_0x502f5b['getFirstRange']();if(_0xc33e03['length']>0x0){const _0x48bd29=_0xc33e03[0x0][_0x5d3c('0x24')](_0x5822f3);if(_0x48bd29){_0xc33e03[0x0]=_0x48bd29;continue;}}_0xc33e03['push'](_0x5822f3);}_0x4ec843['push']([_0x49d29a['view'],_0xc33e03]);}return _0x4ec843;}),this[_0x5d3c('0x3f')](_0x28bbaf,_0x5d3c('0x49'),(_0x547de4,_0x2135a2)=>{let _0x175c12=!0x1;const _0x62b98d=_0x31062d(_0x41833c=>{_0x175c12||_0x41833c?_0x175c12&&_0x41833c&&(this['_destroyController'](_0x2135a2),_0x4a59b6[_0x5d3c('0x3b')](),_0x175c12=!0x1):(this[_0x5d3c('0x38')](_0x2135a2),_0x4a59b6[_0x5d3c('0x3b')](),_0x175c12=!0x0);},0xa);this[_0x5d3c('0x6b')][_0x5d3c('0x12')](_0x2135a2,_0x62b98d),this[_0x5d3c('0x3f')](_0x2135a2,_0x5d3c('0x51'),(_0x503896,_0x57f34e,_0x354aef,_0x208ff9)=>{_0x2135a2[_0x5d3c('0x2a')]&&(null==_0x354aef?(this[_0x5d3c('0x2')](_0x208ff9['head']),_0x62b98d(!0x1)):(this[_0x5d3c('0x2')](_0x354aef[_0x5d3c('0x5f')]),_0x62b98d(!0x0)));}),null===_0x2135a2[_0x5d3c('0x4f')]?_0x62b98d(!0x1):this[_0x5d3c('0x2')](_0x2135a2[_0x5d3c('0x5f')]);}),this[_0x5d3c('0x3f')](_0x28bbaf,_0x5d3c('0x11'),(_0x619bee,_0x1a9e10,_0x5a4407)=>{this['stopListening'](_0x1a9e10,_0x5d3c('0x51')),this['_debouncedHandlers'][_0x5d3c('0x1')](_0x1a9e10)['cancel'](),this['_debouncedHandlers']['delete'](_0x1a9e10);const _0x3bedfd=_0x5a4407?_0x5a4407[_0x5d3c('0x5f')]:_0x1a9e10,_0x5077aa=this[_0x5d3c('0x10')][_0x5d3c('0x1')](_0x3bedfd);null!==_0x5a4407&&this[_0x5d3c('0x2')](_0x3bedfd),null===_0x5a4407&&_0x5077aa&&this['_destroyController'](_0x1a9e10);}),this[_0x5d3c('0x3f')](_0x28bbaf,'suggestionChanged',(_0x2bfbbf,_0x2d6564)=>{this[_0x5d3c('0x2')](_0x2d6564);}),this['listenTo'](_0x4e653c,_0x5d3c('0x23'),(_0x2e970b,_0x56196c,_0x12efdc)=>{const _0x4f9e3a=Array[_0x5d3c('0xf')](_0x12efdc,_0xeec928=>_0xeec928['innerView'])[_0x5d3c('0xc')](_0x22a56e=>this[_0x5d3c('0x54')][_0x5d3c('0x4c')](_0x22a56e)),_0x45dd3a=[];for(const _0x30d67a of _0x4f9e3a){const _0x66606c=this[_0x5d3c('0x54')][_0x5d3c('0x1')](_0x30d67a)[_0x5d3c('0x1c')][_0x5d3c('0x66')]();_0x45dd3a[_0x5d3c('0x69')](..._0x66606c[_0x5d3c('0x57')]((_0x2a5bf1,_0x269680)=>[..._0x2a5bf1,..._0x269680['getMarkerNames']()],[]));}_0x28bbaf[_0x5d3c('0x4d')]=_0x45dd3a;}),this['listenTo'](_0x572138,'addComment',(_0x253fc4,{threadId:_0x421398,isFromAdapter:_0x3d48aa})=>{if(_0x3d48aa||!_0x28bbaf[_0x5d3c('0x14')](_0x421398))return;const _0x27eda1=_0x28bbaf[_0x5d3c('0x60')](_0x421398);this[_0x5d3c('0x10')]['get'](_0x27eda1)[_0x5d3c('0x26')][_0x5d3c('0x47')]();},{'priority':_0x5d3c('0x2c')});}[_0x5d3c('0x50')](_0x3a8dd8){const _0x4c95b7=_0x147936(_0x3a8dd8,_0x41a99c),_0x2ca5cf=this['editor'][_0x5d3c('0x61')][_0x5d3c('0x1')](_0x5d3c('0x42')),_0x2d08b6=_0x467748(_0x3a8dd8,_0x5d3c('0x43'));_0x4c95b7[_0x5d3c('0x5e')][_0x5d3c('0x12')]({'tooltip':_0x2d08b6,'label':_0x2d08b6,'icon':_0x58d7bf}),_0x4c95b7[_0x5d3c('0x5e')][_0x5d3c('0x2f')](_0x5d3c('0x30'))['to'](_0x2ca5cf,_0x5d3c('0x3d')),_0x4c95b7[_0x5d3c('0x5e')]['on']('execute',()=>_0x2ca5cf['execute']());const _0x11066d=new _0x313930(),_0x1fcb3f=[{'type':_0x5d3c('0x35'),'model':{'withText':!0x0,'label':_0x2d08b6,'commandName':'trackChanges'}},{'type':_0x5d3c('0x39')},{'type':_0x5d3c('0x4b'),'model':{'withText':!0x0,'label':_0x467748(_0x3a8dd8,'Accept\x20all\x20suggestions'),'commandName':_0x5d3c('0xd')}},{'type':_0x5d3c('0x4b'),'model':{'withText':!0x0,'label':_0x467748(_0x3a8dd8,_0x5d3c('0x1a')),'commandName':_0x5d3c('0x2e')}},{'type':_0x5d3c('0x4b'),'model':{'withText':!0x0,'label':_0x467748(_0x3a8dd8,_0x5d3c('0x64')),'commandName':'discardAllSuggestions'}},{'type':_0x5d3c('0x4b'),'model':{'withText':!0x0,'label':_0x467748(_0x3a8dd8,_0x5d3c('0x40')),'commandName':_0x5d3c('0x17')}}];for(const _0x2b979e of _0x1fcb3f){const _0x39c1c9={'type':_0x2b979e['type']};if(_0x2b979e[_0x5d3c('0x1c')]){const _0x3a614e=new _0x1d2067(_0x2b979e[_0x5d3c('0x1c')]),_0x2566df=this[_0x5d3c('0x44')]['commands'][_0x5d3c('0x1')](_0x3a614e[_0x5d3c('0x4e')]);_0x3a614e['bind']('isOn',_0x5d3c('0x41'))['to'](_0x2566df,_0x5d3c('0x3d'),_0x5d3c('0x41')),_0x39c1c9['model']=_0x3a614e;}_0x11066d[_0x5d3c('0x3a')](_0x39c1c9);}_0x4487f7(_0x4c95b7,_0x11066d);const _0x157cd8=_0x1fcb3f[_0x5d3c('0xc')](_0x2f0dff=>null!=_0x2f0dff[_0x5d3c('0x1c')])[_0x5d3c('0x1f')](_0x5c3ce9=>this[_0x5d3c('0x44')][_0x5d3c('0x61')][_0x5d3c('0x1')](_0x5c3ce9[_0x5d3c('0x1c')][_0x5d3c('0x4e')]));return _0x4c95b7[_0x5d3c('0x5e')]['actionView'][_0x5d3c('0x5')](_0x5d3c('0x41')),_0x4c95b7[_0x5d3c('0x5e')][_0x5d3c('0x15')][_0x5d3c('0x5')](_0x5d3c('0x41')),_0x4c95b7[_0x5d3c('0x5e')][_0x5d3c('0x58')]['bind'](_0x5d3c('0x41'))['to'](_0x2ca5cf,'isEnabled'),_0x4c95b7['buttonView']['arrowView'][_0x5d3c('0x2f')](_0x5d3c('0x41'))[_0x5d3c('0x5c')](_0x157cd8,_0x5d3c('0x41'),(..._0x391aa7)=>_0x391aa7[_0x5d3c('0xe')](_0x2f7c70=>_0x2f7c70)),_0x4c95b7['on']('execute',_0x1c7a7c=>this[_0x5d3c('0x44')]['execute'](_0x1c7a7c[_0x5d3c('0x62')][_0x5d3c('0x4e')])),_0x4c95b7;}['_initializeController'](_0x2fa742){const _0x12aae4=this[_0x5d3c('0x44')],_0x62b861=_0x12aae4[_0x5d3c('0x65')],_0xaffb4e=_0x12aae4['plugins'][_0x5d3c('0x1')](_0x5d3c('0x1d')),_0x3b8dd0=_0x12aae4[_0x5d3c('0x8')][_0x5d3c('0x1')](_0x5d3c('0x28')),_0x583c74=_0x2fa742[_0x5d3c('0x66')]()['filter'](_0x202d09=>_0x202d09['isInContent']),_0x49e575=_0x12aae4['plugins'][_0x5d3c('0x1')](_0x2478e6)['me'],_0x3c601e=_0x12aae4[_0x5d3c('0x61')][_0x5d3c('0x1')](_0x5d3c('0x13')),_0x1d4d4e=_0x12aae4['commands'][_0x5d3c('0x1')](_0x5d3c('0x55')),_0x1c1ef6=_0x62b861[_0x5d3c('0x1')](_0x5d3c('0x42'))[_0x5d3c('0x20')],{CommentsListView:_0x5edcf9,CommentThreadInputView:_0x26eadc}=_0x12aae4[_0x5d3c('0x8')][_0x5d3c('0x1')]('CommentsUI'),_0xcb0ef4=new _0x1c1ef6(_0x12aae4[_0x5d3c('0x67')],_0x2fa742,_0x49e575,{'disableComments':this[_0x5d3c('0x53')],'editorConfig':_0x62b861[_0x5d3c('0x1')]('comments.editorConfig'),'maxCommentsWhenCollapsed':_0x62b861[_0x5d3c('0x1')](_0x5d3c('0x34')),'maxThreadTotalWeight':_0x62b861[_0x5d3c('0x1')](_0x5d3c('0x56')),'maxCommentCharsWhenCollapsed':_0x62b861[_0x5d3c('0x1')](_0x5d3c('0x2b')),'formatDateTime':_0x47490d(_0x62b861['get'](_0x5d3c('0x67'))),'CommentView':_0x62b861['get'](_0x5d3c('0xb'))[_0x5d3c('0x22')],'CommentsListView':_0x5edcf9,'CommentThreadInputView':_0x26eadc}),_0x9dc1bc=_0x3b8dd0[_0x5d3c('0x68')](_0x2fa742[_0x5d3c('0x4')],_0xcb0ef4),_0x4b07b2=new _0x379cfd(_0x2fa742,_0xcb0ef4,_0x3c601e,_0x1d4d4e,_0x9dc1bc);_0xcb0ef4[_0x5d3c('0x1b')]=_0x12aae4[_0x5d3c('0x8')]['get'](_0x5d3c('0xa'))[_0x5d3c('0x1e')]['getDescriptions'](_0x583c74),this['_suggestionToController'][_0x5d3c('0x12')](_0x2fa742,_0x4b07b2),this['_viewToController'][_0x5d3c('0x12')](_0xcb0ef4,_0x4b07b2);const _0x2feceb=_0xaffb4e['createAnnotationView'](this[_0x5d3c('0x44')][_0x5d3c('0x67')],_0xcb0ef4);_0x2feceb[_0x5d3c('0x2f')]('isDirty')['to'](_0xcb0ef4,'isDirty'),_0x2feceb['bind'](_0x5d3c('0x19'))['to'](_0xcb0ef4),_0x2feceb[_0x5d3c('0x2f')](_0x5d3c('0x21'))['to'](_0xcb0ef4,_0x5d3c('0x21'),_0x36240a=>'suggestion-'+_0x36240a);const _0x18653e=_0xaffb4e[_0x5d3c('0x37')]({'view':_0x2feceb,'target':()=>{const _0x38e41b=_0x583c74[0x0]['getFirstMarker']();if(!_0x38e41b)return null;const _0x8826a3=_0x38e41b[_0x5d3c('0x52')]()[_0x5d3c('0x0')]();return _0x8826a3&&!_0x12aae4[_0x5d3c('0x3e')]['mapper'][_0x5d3c('0x46')](_0x8826a3)?null:_0x1087df(_0x12aae4['editing'],_0x38e41b)||null;},'type':()=>_0x5d3c('0x16')+_0x4b07b2['view'][_0x5d3c('0x21')]});_0xaffb4e[_0x5d3c('0x3a')](_0x18653e);const _0x12f657=_0x12aae4['plugins'][_0x5d3c('0x1')](_0x5d3c('0x5a'));let _0x11ae6a;_0xcb0ef4['on'](_0x5d3c('0x6'),(_0x33028e,_0x504695,_0x9e3b31)=>{_0x9e3b31?_0x11ae6a=_0x12f657[_0x5d3c('0x3a')](_0x467748(this[_0x5d3c('0x44')][_0x5d3c('0x67')],_0x5d3c('0x59'))):(_0x12f657[_0x5d3c('0x18')](_0x11ae6a),_0x11ae6a=null);});}['_destroyController'](_0x3a5d7c){const _0x5564b3=this['editor'][_0x5d3c('0x8')]['get']('Annotations'),_0x3eefb3=this[_0x5d3c('0x10')][_0x5d3c('0x1')](_0x3a5d7c),_0x69112a=_0x3eefb3['view'],_0x58e1a8=_0x5564b3[_0x5d3c('0x29')](_0x69112a);_0x58e1a8&&_0x5564b3[_0x5d3c('0x18')](_0x58e1a8),this[_0x5d3c('0x10')][_0x5d3c('0x4a')](_0x3a5d7c),this[_0x5d3c('0x54')]['delete'](_0x69112a),_0x3eefb3[_0x5d3c('0x63')](),_0x69112a[_0x5d3c('0x63')]();}[_0x5d3c('0x2')](_0x57e762){if(!_0x57e762[_0x5d3c('0x2a')]||!this[_0x5d3c('0x10')][_0x5d3c('0x4c')](_0x57e762))return;const _0x52e6af=this[_0x5d3c('0x44')][_0x5d3c('0x8')]['get'](_0x5d3c('0xa')),_0x289c98=this[_0x5d3c('0x10')][_0x5d3c('0x1')](_0x57e762),_0x26d4b4=_0x57e762[_0x5d3c('0x66')]();_0x289c98[_0x5d3c('0x26')][_0x5d3c('0x1b')]=_0x52e6af[_0x5d3c('0x1e')]['getDescriptions'](_0x26d4b4);}[_0x5d3c('0x63')](){super[_0x5d3c('0x63')]();for(const _0x334f8d of this[_0x5d3c('0x10')][_0x5d3c('0x36')]())this[_0x5d3c('0x9')](_0x334f8d);for(const _0x449199 of this[_0x5d3c('0x6b')][_0x5d3c('0x5d')]())_0x449199[_0x5d3c('0x33')]();this[_0x5d3c('0x6b')][_0x5d3c('0x2d')]();}}