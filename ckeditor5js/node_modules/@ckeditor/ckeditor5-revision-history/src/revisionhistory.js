/*
 *             Copyright (c) 2016 - 2022, CKSource Holding sp. z o.o. All rights reserved.
 *
 *
 *
 *
 *          +---------------------------------------------------------------------------------+
 *          |                                                                                 |
 *          |                                 Hello stranger!                                 |
 *          |                                                                                 |
 *          |                                                                                 |
 *          |   What you're currently looking at is the source code of a legally protected,   |
 *          |    proprietary software. Any attempts to deobfuscate / disassemble this code    |
 *          |               are forbidden and will result in legal consequences.              |
 *          |                                                                                 |
 *          |                                                                                 |
 *          +---------------------------------------------------------------------------------+
 *
 *
 *
 *
 */
const _0x5239=['init','_getRevisionViewerEditorConfig','initialData','changesNavigation','getRevisions','define','closeRevisionViewerCallback','from','has','revisionHistory.viewerEditorElement','restoreRevision','_enhanceCloseRevisionViewerCallback','RevisionHistoryUI','createdAt','getMarkersGroup','requires','RevisionTracker','_restoreRevision','showRevisionViewerCallback','RestrictedEditingMode','restrictedEditingException','WebSocketGateway','adapter','_closeRevisionViewer','commands','set','revisionHistory.viewerContainer','bind','isReadOnly','revisionHistory.showRevisionViewerCallback','_recalculatePageBreaks','numeric','none','data','isReady','saveRevision','isAnonymous','Annotations','extraPlugins','names','concat','every','RevisionHistory','catch','config','then','enableReadOnlyMode','push','get','map','includes','revisionHistory','_viewerEditor','long','refreshPositioning','PaginationLookup','getRevision','CommentsRepository','_update','locale','style','Autosave','refreshVisibility','destroy','markers','pluginName','addRevisionData','name','update','save','block','plugins','addUser','filter','repository','users','RevisionsRepository','toVersion','change','RevisionViewer','indexOf','revision-history-viewer-opened','Users','uiLanguage','create','disableReadOnlyMode','fromVersion','toJSON','getUser','TrackChangesEditing','constructor','isEnabled','_enhanceShowRevisionViewerCallback','getRevisionData','display','toLocaleTimeString','editor','find','error','revisionHistory.editorContainer','_showRevisionViewer'];(function(_0x4d159d,_0x52393b){const _0x5a8545=function(_0x1dcaff){while(--_0x1dcaff){_0x4d159d['push'](_0x4d159d['shift']());}};_0x5a8545(++_0x52393b);}(_0x5239,0x1a8));const _0x5a85=function(_0x4d159d,_0x52393b){_0x4d159d=_0x4d159d-0x0;let _0x5a8545=_0x5239[_0x4d159d];return _0x5a8545;};import{Plugin as _0x26aed0}from'ckeditor5/src/core';import{CKEditorError as _0x5b5d71,uid as _0x4ebe7a}from'ckeditor5/src/utils';import _0x4ca213 from'./revisiontracker';import _0x2b8568 from'./ui/revisionhistory/revisionhistoryui';import _0x475853 from'./revisionviewer';import _0x1c38d7 from'./ui/revisionviewer/revisionviewerui';import _0x317c90 from'./ui/revisionssidebar/revisionssidebar';import _0x4103ad from'./editor/revisionviewereditor';import{getTranslation as _0x301904}from'./utils/common-translations';const g=['context'],k=[_0x5a85('0x61'),_0x5a85('0x5d'),_0x5a85('0x1'),_0x5a85('0x25'),_0x5a85('0x45'),_0x5a85('0x64'),_0x5a85('0x29')];export default class C extends _0x26aed0{static get[_0x5a85('0x2d')](){return _0x5a85('0x16');}static get[_0x5a85('0x60')](){return[_0x4ca213,_0x2b8568];}constructor(..._0x39a86b){if(super(..._0x39a86b),!this[_0x5a85('0x4c')][_0x5a85('0x18')][_0x5a85('0x1c')](_0x5a85('0x1f')))throw new _0x5b5d71('revision-history-missing-configuration',this);this['_viewerEditor']=null,this[_0x5a85('0x4c')][_0x5a85('0x18')][_0x5a85('0x56')]('revisionHistory.showRevisionViewerCallback',_0x115d70=>this[_0x5a85('0x50')](_0x115d70)),this['editor']['config'][_0x5a85('0x56')]('revisionHistory.closeRevisionViewerCallback',_0x17aff3=>this['_closeRevisionViewer'](_0x17aff3)),this[_0x5a85('0x4c')]['config'][_0x5a85('0x56')]('revisionHistory.restoreRevisionCallback',_0x84da4c=>this[_0x5a85('0x62')](_0x84da4c)),this[_0x5a85('0x48')](),this[_0x5a85('0x5c')]();}set[_0x5a85('0x2')](_0x219007){this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x1c')]('RevisionTracker')[_0x5a85('0x2')]=_0x219007;}get[_0x5a85('0x2')](){return this[_0x5a85('0x4c')]['plugins']['get'](_0x5a85('0x61'))[_0x5a85('0x2')];}[_0x5a85('0x2e')](..._0x52f8f5){return this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x1c')](_0x5a85('0x61'))['addRevisionData'](..._0x52f8f5);}[_0x5a85('0x24')](..._0x208d0f){return this[_0x5a85('0x4c')][_0x5a85('0x33')][_0x5a85('0x1c')](_0x5a85('0x38'))[_0x5a85('0x24')](..._0x208d0f);}['getRevisions'](..._0x2c96aa){return this[_0x5a85('0x4c')][_0x5a85('0x33')]['get'](_0x5a85('0x38'))[_0x5a85('0x55')](..._0x2c96aa);}[_0x5a85('0x52')](){const _0x1cac64={},_0x1598d0=this['editor'],_0x133150=_0x1598d0[_0x5a85('0x33')]['get'](_0x5a85('0x61')),_0xf366c2=_0x1598d0[_0x5a85('0x33')]['get'](_0x5a85('0x3e'))[_0x5a85('0x37')];for(const _0xe76d49 of _0x1598d0[_0x5a85('0x18')][_0x5a85('0x13')]())g[_0x5a85('0x1e')](_0xe76d49)||(_0x1cac64[_0xe76d49]=_0x1598d0['config'][_0x5a85('0x1c')](_0xe76d49));_0x1cac64[_0x5a85('0x53')]='',_0x1cac64['toolbar']=['exitToEditing',_0x5a85('0x5b'),_0x5a85('0x54')];const _0x5e3d03=this[_0x5a85('0x4c')][_0x5a85('0x46')]['builtinPlugins']||[],_0x5a677a=_0x1cac64['extraPlugins']||[];delete _0x1cac64[_0x5a85('0x12')];const _0x2cf188=_0x5e3d03[_0x5a85('0x14')](_0x1cac64[_0x5a85('0x33')])['concat'](_0x5a677a)[_0x5a85('0x1d')](_0x56bbe1=>'string'==typeof _0x56bbe1?_0x5e3d03[_0x5a85('0x4d')](_0x244a57=>_0x244a57[_0x5a85('0x2d')]==_0x56bbe1):_0x56bbe1);return _0x1cac64[_0x5a85('0x33')]=Array[_0x5a85('0x58')](new Set(_0x2cf188))[_0x5a85('0x35')](_0x22515b=>H(_0x22515b,_0x1598d0[_0x5a85('0x33')],[])),(_0x1cac64[_0x5a85('0x33')][_0x5a85('0x1b')](_0x475853,_0x1c38d7,class extends _0x26aed0{static get[_0x5a85('0x60')](){return[_0x475853,_0x5a85('0x3e')];}[_0x5a85('0x51')](){const _0x158838=this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x1c')]('Users');for(const _0x83bd67 of _0xf366c2)_0x83bd67[_0x5a85('0x10')]||_0x158838[_0x5a85('0x44')](_0x83bd67['id'])||_0x158838[_0x5a85('0x34')](_0x83bd67);const _0x17172a=_0x133150['repository']['getRevisions']();let _0x4710dd=null;const _0x4422c8=this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x1c')](_0x5a85('0x3b'));_0x4422c8[_0x5a85('0x2')]=_0x133150[_0x5a85('0x2')],_0x4422c8[_0x5a85('0x7')](_0x5a85('0x47'))['to'](_0x133150),this[_0x5a85('0x4c')][_0x5a85('0x4')][_0x5a85('0x1c')]('restoreRevision')[_0x5a85('0x7')]('isEnabled')['to'](_0x1598d0,_0x5a85('0x8'),_0x5c13f6=>!_0x5c13f6);for(const _0x13cd8f of _0x17172a){const _0x2345e5=null===_0x13cd8f['creator'];if(_0x2345e5&&_0x13cd8f['toVersion']===_0x13cd8f[_0x5a85('0x42')])continue;const _0x567084=_0x13cd8f['toJSON']();_0x4422c8['addRevisionData'](_0x567084,(_0x50aed4,_0x4e6452,_0xa1e403)=>{if(_0x2345e5){if(_0x4710dd)_0x4710dd[_0x5a85('0x26')](_0x50aed4,_0x4e6452);else{if(!_0x4e6452){const _0x1ff479=_0xa1e403[_0x5a85('0x43')]();_0x1ff479['id']=_0x4ebe7a(),_0x133150['saveRevision'](_0x1ff479,_0xa1e403[_0x5a85('0x39')])[_0x5a85('0x19')](_0x5ae01c=>{_0x4710dd=_0x5ae01c;});}}}else _0x13cd8f[_0x5a85('0x26')](_0x50aed4,_0x4e6452);});}}},_0x317c90),_0x1cac64);}['_enhanceShowRevisionViewerCallback'](){const _0x151abf=this['editor'][_0x5a85('0x18')][_0x5a85('0x1c')](_0x5a85('0x1f'))[_0x5a85('0x63')];this[_0x5a85('0x4c')][_0x5a85('0x18')]['set'](_0x5a85('0x9'),async()=>{this[_0x5a85('0x4c')][_0x5a85('0x1a')]('revision-history-viewer-opened');const _0x11837b=this['editor'][_0x5a85('0x33')]['get'](_0x5a85('0x61'));this[_0x5a85('0x4c')][_0x5a85('0x33')][_0x5a85('0x59')]('Autosave')?await this[_0x5a85('0x4c')][_0x5a85('0x33')]['get'](_0x5a85('0x29'))[_0x5a85('0x31')]():await _0x11837b[_0x5a85('0x30')](),this[_0x5a85('0x4c')][_0x5a85('0x33')][_0x5a85('0x59')]('PaginationLookup')&&this[_0x5a85('0x4c')][_0x5a85('0x33')]['get'](_0x5a85('0x23'))['_recalculatePageBreaks']();const _0x2b162b=this[_0x5a85('0x52')]();return _0x151abf(_0x2b162b)[_0x5a85('0x19')](_0x172be2=>{this[_0x5a85('0x20')]=_0x172be2,this[_0x5a85('0x4c')][_0x5a85('0x33')][_0x5a85('0x59')](_0x5a85('0x11'))&&this['editor']['plugins'][_0x5a85('0x1c')](_0x5a85('0x11'))[_0x5a85('0x2a')]();})[_0x5a85('0x17')](_0x155684=>{console[_0x5a85('0x4e')](_0x155684),this[_0x5a85('0x4c')][_0x5a85('0x41')](_0x5a85('0x3d'));});});}[_0x5a85('0x5c')](){const _0x5c2084=this[_0x5a85('0x4c')]['config']['get'](_0x5a85('0x1f'))[_0x5a85('0x57')];this[_0x5a85('0x4c')][_0x5a85('0x18')][_0x5a85('0x5')]('revisionHistory.closeRevisionViewerCallback',()=>(this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x59')](_0x5a85('0x23'))&&this[_0x5a85('0x4c')]['plugins'][_0x5a85('0x1c')](_0x5a85('0x23'))[_0x5a85('0xa')](),_0x5c2084(this[_0x5a85('0x20')])[_0x5a85('0x19')](()=>{this[_0x5a85('0x4c')][_0x5a85('0x41')]('revision-history-viewer-opened'),this[_0x5a85('0x20')]=null,this['editor'][_0x5a85('0x33')][_0x5a85('0x59')](_0x5a85('0x11'))&&(this[_0x5a85('0x4c')][_0x5a85('0x33')][_0x5a85('0x1c')](_0x5a85('0x11'))[_0x5a85('0x2a')](),this['editor'][_0x5a85('0x33')][_0x5a85('0x1c')](_0x5a85('0x11'))[_0x5a85('0x22')]());})));}[_0x5a85('0x50')](_0x296209){const _0x4382dc=this[_0x5a85('0x4c')]['config'][_0x5a85('0x1c')](_0x5a85('0x4f')),_0x5a011a=this[_0x5a85('0x4c')]['config'][_0x5a85('0x1c')](_0x5a85('0x6')),_0x54d705=this['editor'][_0x5a85('0x18')][_0x5a85('0x1c')](_0x5a85('0x5a'));return _0x4103ad[_0x5a85('0x40')](_0x54d705,_0x296209)[_0x5a85('0x19')](_0x4f947d=>(_0x5a011a[_0x5a85('0x28')][_0x5a85('0x4a')]=_0x5a85('0x32'),_0x4382dc[_0x5a85('0x28')][_0x5a85('0x4a')]=_0x5a85('0xc'),_0x4f947d));}[_0x5a85('0x3')](_0x439772){const _0x57e0f3=this['editor']['config'][_0x5a85('0x1c')]('revisionHistory.editorContainer');return this['editor'][_0x5a85('0x18')][_0x5a85('0x1c')](_0x5a85('0x6'))[_0x5a85('0x28')][_0x5a85('0x4a')]=_0x5a85('0xc'),_0x57e0f3[_0x5a85('0x28')]['display']='',_0x439772[_0x5a85('0x2b')]();}async['_restoreRevision'](_0xe671dd){const _0x401cd0=this[_0x5a85('0x4c')],_0x192f63=this[_0x5a85('0x20')][_0x5a85('0x33')][_0x5a85('0x1c')](_0x5a85('0x3b')),_0x4a3929=_0x401cd0[_0x5a85('0x33')][_0x5a85('0x1c')](_0x5a85('0x61')),_0x238704=_0x192f63[_0x5a85('0x36')][_0x5a85('0x24')](_0xe671dd);let _0x22fa39,_0x63f13a;try{_0x22fa39=await _0x192f63[_0x5a85('0x49')](_0x238704);}catch(_0x4cf744){return void console[_0x5a85('0x4e')](_0x4cf744);}_0x401cd0['model'][_0x5a85('0x3a')](_0xbdfd0d=>{for(const _0x109494 of Array[_0x5a85('0x58')](_0x401cd0['model'][_0x5a85('0x2c')][_0x5a85('0x5f')](_0x5a85('0x0'))))_0xbdfd0d['removeMarker'](_0x109494);}),_0x192f63[_0x5a85('0xe')]=!0x1,_0x401cd0[_0x5a85('0xd')][_0x5a85('0x5')](_0x22fa39,{'suppressErrorInCollaboration':!0x0});const _0x2a20e0=_0x301904(_0x401cd0[_0x5a85('0x27')],'Restored');if(_0x238704['name'])_0x63f13a=-0x1==_0x238704['name'][_0x5a85('0x3c')](_0x2a20e0)?_0x2a20e0+':\x20'+_0x238704[_0x5a85('0x2f')]:_0x238704[_0x5a85('0x2f')];else _0x63f13a=_0x2a20e0+':\x20'+(_0x238704[_0x5a85('0x5e')]['toLocaleDateString'](_0x401cd0[_0x5a85('0x27')][_0x5a85('0x3f')],{'month':_0x5a85('0x21'),'day':_0x5a85('0xb')})+',\x20'+_0x238704[_0x5a85('0x5e')][_0x5a85('0x4b')](_0x401cd0[_0x5a85('0x27')]['uiLanguage'],{'hour':_0x5a85('0xb'),'minute':_0x5a85('0xb')}));return await _0x4a3929[_0x5a85('0xf')]({'name':_0x63f13a}),_0x192f63[_0x5a85('0xe')]=!0x0,_0x401cd0[_0x5a85('0x18')][_0x5a85('0x1c')](_0x5a85('0x1f'))[_0x5a85('0x57')]();}}function H(_0x1299c4,_0x72d7de,_0x53e4cf){const _0x2a6c7e='function'==typeof _0x1299c4?_0x1299c4[_0x5a85('0x2d')]||_0x1299c4['name']:_0x1299c4;if(_0x53e4cf[_0x5a85('0x1e')](_0x2a6c7e))return!0x0;if(_0x53e4cf[_0x5a85('0x1b')](_0x2a6c7e),k[_0x5a85('0x1e')](_0x2a6c7e))return!0x1;const _0xdb0ff5=(('function'==typeof _0x1299c4?_0x1299c4:_0x72d7de['has'](_0x2a6c7e)?_0x72d7de['get'](_0x2a6c7e):{})[_0x5a85('0x60')]||[])[_0x5a85('0x15')](_0x3cefc6=>H(_0x3cefc6,_0x72d7de,_0x53e4cf));return _0xdb0ff5||k[_0x5a85('0x1b')](_0x2a6c7e),_0xdb0ff5;}